"use strict";(self.webpackChunkfull_stack_chronicles=self.webpackChunkfull_stack_chronicles||[]).push([[58926],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>m});var n=o(67294);function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,i=function(e,t){if(null==e)return{};var o,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(i[o]=e[o]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},g="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var o=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),g=c(o),d=i,m=g["".concat(s,".").concat(d)]||g[d]||p[d]||r;return o?n.createElement(m,a(a({ref:t},u),{},{components:o})):n.createElement(m,a({ref:t},u))}));function m(e,t){var o=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=o.length,a=new Array(r);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[g]="string"==typeof e?e:i,a[1]=l;for(var c=2;c<r;c++)a[c]=o[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},65105:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var n=o(87462),i=(o(67294),o(3905)),r=o(59943);const a={slug:"netlify-logging-to-sumologic-without-log-drains",title:"Netlify logging to SumoLogic Without Log Drains",authors:["jeffreyaven"],draft:!1,image:"/img/blog/netlify-logging-to-sumologic-without-log-drains.png",tags:["netlify","sumologic","JAMStack","logging","log drain"],keywords:["netlify","sumologic","JAMStack","logging","log drain"],description:"This is a solution to get verbose logs from Netlify functions and CDN logs to SumoLogic without needing a Log Drain."},l=void 0,s={permalink:"/netlify-logging-to-sumologic-without-log-drains",editUrl:"https://github.com/stackql/fullstackchronicles.io/edit/main/src/blog/2023-02-06-netlify-logging-to-sumologic-without-log-drains/index.md",source:"@site/blog/2023-02-06-netlify-logging-to-sumologic-without-log-drains/index.md",title:"Netlify logging to SumoLogic Without Log Drains",description:"This is a solution to get verbose logs from Netlify functions and CDN logs to SumoLogic without needing a Log Drain.",date:"2023-02-06T00:00:00.000Z",formattedDate:"February 6, 2023",tags:[{label:"netlify",permalink:"/tags/netlify"},{label:"sumologic",permalink:"/tags/sumologic"},{label:"JAMStack",permalink:"/tags/jam-stack"},{label:"logging",permalink:"/tags/logging"},{label:"log drain",permalink:"/tags/log-drain"}],readingTime:1.92,hasTruncateMarker:!1,authors:[{name:"Jeffrey Aven",title:"Technologist and Cloud Consultant",url:"https://www.linkedin.com/in/jeffreyaven/",imageURL:"https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80",key:"jeffreyaven"}],frontMatter:{slug:"netlify-logging-to-sumologic-without-log-drains",title:"Netlify logging to SumoLogic Without Log Drains",authors:["jeffreyaven"],draft:!1,image:"/img/blog/netlify-logging-to-sumologic-without-log-drains.png",tags:["netlify","sumologic","JAMStack","logging","log drain"],keywords:["netlify","sumologic","JAMStack","logging","log drain"],description:"This is a solution to get verbose logs from Netlify functions and CDN logs to SumoLogic without needing a Log Drain."},prevItem:{title:"Databricks in 5 Minutes",permalink:"/databricks-in-five-minutes"},nextItem:{title:"Enhancing dbt Snapshots with Operational Metadata",permalink:"/enhancing-dbt-snapshots-with-operational-metadata"}},c={authorsImageUrls:[void 0]},u=[{value:"Solution Overview",id:"solution-overview",level:2},{value:"Steps",id:"steps",level:2},{value:"Step 1.  Set up a Collector and Source",id:"step-1--set-up-a-collector-and-source",level:3},{value:"Step 2.  Create Netlify Environment Variable(s)",id:"step-2--create-netlify-environment-variables",level:3},{value:"Step 3.  Create a logging module",id:"step-3--create-a-logging-module",level:3},{value:"Step 4.  Import and use the logging module",id:"step-4--import-and-use-the-logging-module",level:3}],g={toc:u},p="wrapper";function d(e){let{components:t,...o}=e;return(0,i.kt)(p,(0,n.Z)({},g,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Log Drains for function and CDN logs from Netlify, which have native SumoLogic collectors available, are included with Enterprise level subscriptions.  However, there is a quantum jump in subscription costs between the Teams or Pro Editions of Netlify and the Enterprise Edition.  "),(0,i.kt)("p",null,"If you are deploying a JAMStack app in Netlify, the odds are each page will include an API call (using Netlify functions), and for authenticated pages, the request will include a Bearer Token.  "),(0,i.kt)("h2",{id:"solution-overview"},"Solution Overview"),(0,i.kt)("p",null,"Create a logging module that exports functions that can be used by any of your Netlify functions to log verbose data to the console (seen in the function log output in the Netlify app) and to push log events to a Hosted SumoLogic Collector Source.  This will allow you to see verbose logs for each function call and CDN logs for each page load.  "),(0,i.kt)("h2",{id:"steps"},"Steps"),(0,i.kt)("p",null,"Steps to deploy this solution are detailed here:  "),(0,i.kt)("h3",{id:"step-1--set-up-a-collector-and-source"},"Step 1.  Set up a Collector and Source"),(0,i.kt)("p",null,"Set up a Custom HTTP Collector and Source in SumoLogic (copy the source URL) using the SumoLogic web interface; see the documentation here:  ",(0,i.kt)("a",{parentName:"p",href:"https://help.sumologic.com/03Send-Data/Sources/02Sources-for-Hosted-Collectors/HTTP-Source/Upload-Data-to-an-HTTP-Source"},"https://help.sumologic.com/03Send-Data/Sources/02Sources-for-Hosted-Collectors/HTTP-Source/Upload-Data-to-an-HTTP-Source"),"."),(0,i.kt)("h3",{id:"step-2--create-netlify-environment-variables"},"Step 2.  Create Netlify Environment Variable(s)"),(0,i.kt)("p",null,"Create a build time environment variable in Netlify for the Sumo Source URL you generated in Step 1 (in this case, I have called it ",(0,i.kt)("inlineCode",{parentName:"p"},"SUMO_REQUEST_SOURCE_URL"),")."),(0,i.kt)("h3",{id:"step-3--create-a-logging-module"},"Step 3.  Create a logging module"),(0,i.kt)("p",null,"Create your logging module (this example is in TypeScript, but you could implement the same logic in any other language/runtime).  In this case, we will unpack the request event and send the fields to the collector source.  "),(0,i.kt)(r.Z,{id:"7b218eee7984c81302ac59e15279c72b",mdxType:"Gist"}),(0,i.kt)("h3",{id:"step-4--import-and-use-the-logging-module"},"Step 4.  Import and use the logging module"),(0,i.kt)("p",null,"Now import and use the ",(0,i.kt)("inlineCode",{parentName:"p"},"logRequest")," function at the beginning of each Netlify function you deploy.  "),(0,i.kt)(r.Z,{id:"f0e6c21b256a9fa72cb40d9f09084a8d",mdxType:"Gist"}),(0,i.kt)("p",null,"You will now get verbose logs (similar to CDN logs) to the Netlify console and to Sumo Logic!  "),(0,i.kt)("p",null,"You can implement similar functions for each request to log the ",(0,i.kt)("inlineCode",{parentName:"p"},"jwtId")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"userInfo")," from the Bearer Token.  This will allow you to see the user information for each request in SumoLogic.  "),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Your http response header should include:  "),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"headers: {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Headers': 'Content-Type',\n  ...\n},\n"))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"if you have enjoyed this post, please consider ",(0,i.kt)("a",{parentName:"p",href:"https://www.buymeacoffee.com/jeffreyaven"},(0,i.kt)("strong",{parentName:"a"},"buying me a coffee \u2615"))," to help me keep writing!")))}d.isMDXComponent=!0},59943:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(67294);function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}const r=function(e){var t,o;function r(){return e.apply(this,arguments)||this}o=e,(t=r).prototype=Object.create(o.prototype),t.prototype.constructor=t,i(t,o);var a=r.prototype;return a.componentDidMount=function(){this._updateIframeContent()},a.componentDidUpdate=function(e,t){this._updateIframeContent()},a._defineUrl=function(){var e=this.props,t=e.id,o=e.file;return"https://gist.github.com/"+t+".js"+(o?"?file="+o:"")},a._updateIframeContent=function(){var e=this.props,t=e.id,o=e.file,n=this.iframeNode,i=n.document;n.contentDocument?i=n.contentDocument:n.contentWindow&&(i=n.contentWindow.document);var r='<html><head><base target="_parent"><style>*{font-size:12px;}</style></head><body '+("onload=\"parent.document.getElementById('"+(o?"gist-"+t+"-"+o:"gist-"+t)+"').style.height=document.body.scrollHeight + 'px'\"")+">"+('<script type="text/javascript" src="'+this._defineUrl()+'"><\/script>')+"</body></html>";i.open(),i.writeln(r),i.close()},a.render=function(){var e=this,t=this.props,o=t.id,i=t.file;return n.createElement("iframe",{ref:function(t){e.iframeNode=t},width:"100%",frameBorder:0,id:i?"gist-"+o+"-"+i:"gist-"+o})},r}(n.PureComponent)}}]);