"use strict";(self.webpackChunkfull_stack_chronicles=self.webpackChunkfull_stack_chronicles||[]).push([[46946],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>p});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=u(n),p=r,f=m["".concat(s,".").concat(p)]||m[p]||d[p]||o;return n?a.createElement(f,l(l({ref:t},c),{},{components:n})):a.createElement(f,l({ref:t},c))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},58949:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>u,toc:()=>d});var a=n(83117),r=(n(67294),n(3905)),o=n(73992),l=n(18679);const i={slug:"dbt-in-five-minutes",title:"DBT in 5 Minutes",authors:["jeffreyaven"],draft:!1,image:"/img/blog/dbt-in-five-minutes.png",tags:["dbt","elt","etl","sql","snowflake","bigquery"],keywords:["dbt","elt","etl","sql","snowflake","bigquery"],description:"This article gives a quick and straightforward introduction to dbt - the Data Build Tool - with examples using BigQuery."},s=void 0,u={permalink:"/dbt-in-five-minutes",editUrl:"https://github.com/stackql/fullstackchronicles.io/edit/main/src/blog/2022-08-05-dbt-in-five-minutes/index.md",source:"@site/blog/2022-08-05-dbt-in-five-minutes/index.md",title:"DBT in 5 Minutes",description:"This article gives a quick and straightforward introduction to dbt - the Data Build Tool - with examples using BigQuery.",date:"2022-08-05T00:00:00.000Z",formattedDate:"August 5, 2022",tags:[{label:"dbt",permalink:"/tags/dbt"},{label:"elt",permalink:"/tags/elt"},{label:"etl",permalink:"/tags/etl"},{label:"sql",permalink:"/tags/sql"},{label:"snowflake",permalink:"/tags/snowflake"},{label:"bigquery",permalink:"/tags/bigquery"}],readingTime:5.08,hasTruncateMarker:!1,authors:[{name:"Jeffrey Aven",title:"Technologist and Cloud Consultant",url:"https://www.linkedin.com/in/jeffreyaven/",imageURL:"https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80",key:"jeffreyaven"}],frontMatter:{slug:"dbt-in-five-minutes",title:"DBT in 5 Minutes",authors:["jeffreyaven"],draft:!1,image:"/img/blog/dbt-in-five-minutes.png",tags:["dbt","elt","etl","sql","snowflake","bigquery"],keywords:["dbt","elt","etl","sql","snowflake","bigquery"],description:"This article gives a quick and straightforward introduction to dbt - the Data Build Tool - with examples using BigQuery."},prevItem:{title:"Deno in 5 Minutes",permalink:"/deno-in-five-minutes"},nextItem:{title:"Loading Parquet Files into Snowflake",permalink:"/loading-parquet-files-into-snowflake"}},c={authorsImageUrls:[void 0]},d=[{value:"Summary",id:"summary",level:2},{value:"Models",id:"models",level:2},{value:"DBT Project",id:"dbt-project",level:2},{value:"Running DBT Models",id:"running-dbt-models",level:2},{value:"Other Stuff",id:"other-stuff",level:2}],m={toc:d};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/"},(0,r.kt)("strong",{parentName:"a"},"DBT (or Data Build Tool)"))," is a modern data transformation tool born in the cloud/DevOps era. It's a great project which much has been written about; I will try to give as brief an overview as possible.  "),(0,r.kt)("details",null,(0,r.kt)("summary",null,"ETL vs ELT Refresher"),(0,r.kt)("p",null,"A quick refresher on ELT vs ETL before we discuss DBT. I have created an infographic for this..."),(0,r.kt)("a",{target:"_blank",href:"/img/blog/dbt-in-five-minutes/etl-vs-elt.png"},(0,r.kt)("img",{loading:"lazy",alt:"ETL vs ELT",src:"/img/blog/dbt-in-five-minutes/etl-vs-elt.png",width:"595",height:"410",class:"img_node_modules-@docusaurus-theme-classic-lib-theme-MDXComponents-Img-styles-module"}))),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"DBT is an open-source command line tool written in Python from DBT Labs (formerly Fishtown Analytics).  "),(0,r.kt)("p",null,"DBT is designed to manage data transformations while applying software engineering best practices (including version control, automated testing, reviews, approvals, etc).  Its modern software engineering and cloud-first design goals separate it from its old-school ETL/ELT predecessors.  "),(0,r.kt)("p",null,"DBT is an ",(0,r.kt)("strong",{parentName:"p"},"ELT")," tool focusing on the ",(0,r.kt)("strong",{parentName:"p"},"T"),"(ransform) only, the E(xtract) and L(oad) are up to you (there are plenty of tools that specialize in this).  "),(0,r.kt)("p",null,"At its core DBT is a templating engine using Jinja (Python templating engine); it generates templates that represent SQL commands to create, replace or update objects in your database (the ",(0,r.kt)("strong",{parentName:"p"},"\u201cT\u201d"),' in ELT), then oversees the execution of the templated commands.  The work is "pushed down" to the underlying database containing the source and target objects and data.   '),(0,r.kt)("h2",{id:"models"},"Models"),(0,r.kt)("p",null,"The concept most integral to DBT is the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/docs/building-a-dbt-project/building-models"},(0,r.kt)("strong",{parentName:"a"},"Model")),".  A Model is simply a representation of a transform (or set of transforms) to a dataset, resulting in a target object (which could be a table or tables in a datamart).  A model is expressed as a ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," statement stored in a ",(0,r.kt)("inlineCode",{parentName:"p"},".sql")," file in your ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt")," project (well get to that in a minute).  "),(0,r.kt)("p",null,"Suppose we want to create a denormalized fact table for commits to store in a datamart in BigQuery.  This is what a model file might look like (using the BigQuery SQL dialect and referencing objects that should exist and be accessible at runtime when we execute the model).  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"{{ config(materialized='table') }}\n\nwith commits as (\n    SELECT \n    SUBSTR(commit, 0, 13) as commit_short_sha,\n    committer.name as commiter_name,\n    committer.date as commit_date,\n    message,\n    repo_name\n    FROM `bigquery-public-data.github_repos.sample_commits` c\n)\n\nselect * from commits\n")),(0,r.kt)("p",null,"Models are created as views by default, but you can materialize these as tables where needed.  "),(0,r.kt)("p",null,"You configure connectivity to the target database using ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/docs/available-adapters"},(0,r.kt)("strong",{parentName:"a"},"adapters"))," (software libraries provided by dbt in the case of most mainstream databases) and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/dbt-cli/configure-your-profile"},(0,r.kt)("strong",{parentName:"a"},"profiles"))," (which contain details around authentication, databases/datasets, schemas etc).  "),(0,r.kt)("h2",{id:"dbt-project"},"DBT Project"),(0,r.kt)("p",null,"A DBT project is simply a folder containing your models and some other configuration data.  You can initialize this by running ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/commands/init"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"dbt init")))," from your desired project directory.  In its most basic form, the structure looks like this:  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"models/\n\u251c\u2500 your_model.sql\n\u251c\u2500 schema.yml\ndbt_project.yml\n")),(0,r.kt)("p",null,"Your models can be created under subfolders for organization.  ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/resource-configs/schema"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"schema.yml")))," is an optional file that  contains tests for columns, can also include descriptions for documentation.  The ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/dbt_project.yml"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"dbt_project.yml")))," file is the main entry point for the ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt")," program, it contains the configuration for the project, including which ",(0,r.kt)("inlineCode",{parentName:"p"},"profile")," to use.  Profiles (stored in a file called ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/profiles.yml"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"profiles.yml")))," store all of the necessary connectivity information for your target database platform.  By default ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt init")," creates this file a ",(0,r.kt)("inlineCode",{parentName:"p"},".dbt")," folder under your home directory.  "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You could store this with your project (be careful not to commit secrets like database credentials to source control).  If you store it in any other directory than the default, you will need to tell ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt")," where it can find this file using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--profiles-dir")," argument of any ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt")," command, see ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/dbt-cli/configure-your-profile#advanced-customizing-a-profile-directory"},(0,r.kt)("strong",{parentName:"a"},"here"))," for more information.")),(0,r.kt)("p",null,"To confirm your project is ship shape, run ",(0,r.kt)("a",{parentName:"p",href:"https://docs.getdbt.com/reference/commands/parse"},(0,r.kt)("strong",{parentName:"a"},(0,r.kt)("inlineCode",{parentName:"strong"},"dbt parse"))),"; if there are no errors, you are good to proceed running and testing your models.  "),(0,r.kt)("h2",{id:"running-dbt-models"},"Running DBT Models"),(0,r.kt)("p",null,"To run your models, simply run the following command from the directory containing your ",(0,r.kt)("inlineCode",{parentName:"p"},"dbt_project.yml")," file (typically the root of your project folder):  "),(0,r.kt)(o.Z,{defaultValue:"command",values:[{label:"Command",value:"command"},{label:"Output",value:"output"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"command",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("b",null,(0,r.kt)("a",{target:"_blank",href:"https://docs.getdbt.com/reference/commands/run"},"dbt run")))),(0,r.kt)(l.Z,{value:"output",mdxType:"TabItem"},(0,r.kt)("pre",null,"06:56:36  Running with dbt=1.2.0",(0,r.kt)("br",null),"06:56:36  Found 1 model, 2 tests, 0 snapshots, 0 analyses, 285 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics",(0,r.kt)("br",null),"06:56:36",(0,r.kt)("br",null),"06:56:37  Concurrency: 1 threads (target='dev')",(0,r.kt)("br",null),"06:56:37",(0,r.kt)("br",null),"06:56:37  1 of 1 START table model dbt_dataset.fct_commits ............................... [RUN]",(0,r.kt)("br",null),"06:56:50  1 of 1 OK created table model dbt_dataset.fct_commits .......................... [CREATE TABLE (672.3k rows, 396.7 MB processed) in 13.28s]",(0,r.kt)("br",null),"06:56:50",(0,r.kt)("br",null),"06:56:50  Finished running 1 table model in 0 hours 0 minutes and 14.01 seconds (14.01s).",(0,r.kt)("br",null),"06:56:50",(0,r.kt)("br",null),"06:56:50  Completed successfully",(0,r.kt)("br",null),"06:56:50",(0,r.kt)("br",null),"06:56:50  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1"))),(0,r.kt)("p",null,"Model deployed!  Let's test it:   "),(0,r.kt)(o.Z,{defaultValue:"command",values:[{label:"Command",value:"command"},{label:"Output",value:"output"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"command",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("b",null,(0,r.kt)("a",{target:"_blank",href:"https://docs.getdbt.com/reference/commands/test"},"dbt test")))),(0,r.kt)(l.Z,{value:"output",mdxType:"TabItem"},(0,r.kt)("pre",null,"06:57:19  Running with dbt=1.2.0",(0,r.kt)("br",null),"06:57:19  Found 1 model, 2 tests, 0 snapshots, 0 analyses, 285 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics",(0,r.kt)("br",null),"06:57:19",(0,r.kt)("br",null),"06:57:19  Concurrency: 1 threads (target='dev')",(0,r.kt)("br",null),"06:57:19",(0,r.kt)("br",null),"06:57:19  1 of 2 START test not_null_fct_commits_commit_short_sha ........................ [RUN]",(0,r.kt)("br",null),"06:57:21  1 of 2 PASS not_null_fct_commits_commit_short_sha .............................. [PASS in 1.88s]",(0,r.kt)("br",null),"06:57:21  2 of 2 START test unique_fct_commits_commit_short_sha .......................... [RUN]",(0,r.kt)("br",null),"06:57:24  2 of 2 PASS unique_fct_commits_commit_short_sha ................................ [PASS in 3.14s]",(0,r.kt)("br",null),"06:57:24",(0,r.kt)("br",null),"06:57:24  Finished running 2 tests in 0 hours 0 minutes and 5.41 seconds (5.41s).",(0,r.kt)("br",null),"06:57:24",(0,r.kt)("br",null),"06:57:24  Completed successfully",(0,r.kt)("br",null),"06:57:24",(0,r.kt)("br",null),"06:57:24  Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2"))),(0,r.kt)("p",null,"This will run all of the tests associated with your model(s) - in this case, ",(0,r.kt)("inlineCode",{parentName:"p"},"not null")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"unique")," tests defined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"schema.yml")," file.  That's it, deployed and tested.  "),(0,r.kt)("h2",{id:"other-stuff"},"Other Stuff"),(0,r.kt)("p",null,"There is some other stuff in DBT you should be aware of, like ",(0,r.kt)("inlineCode",{parentName:"p"},"seeds"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"snapshots"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"analyses"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"macros"),", and more but our five minutes is up \ud83d\ude03.  We can discuss these next time; you are up and running with the basics of DBT now, get transforming!"))}p.isMDXComponent=!0},18679:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(67294),r=n(34334);const o="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,l),hidden:n},t)}},73992:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(83117),r=n(67294),o=n(34334),l=n(76775),i=n(75238),s=n(33609),u=n(92560);function c(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function d(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??c(n);return function(e){const t=(0,s.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=d(e),[l,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[s,c]=p({queryString:n,groupId:a}),[f,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,u.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),h=(()=>{const e=s??f;return m({value:e,tabValues:o})?e:null})();(0,r.useEffect)((()=>{h&&i(h)}),[h]);return{selectedValue:l,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),b(e)}),[c,b,o]),tabValues:o}}var b=n(72957),h=n(51048);const g="tabList__CuJ",k="tabItem_LNqP";function y(e){let{className:t,block:n,selectedValue:l,selectValue:i,tabValues:s}=e;const u=[],{blockElementScrollPositionUntilNextRender:c}=(0,b.o5)(),d=e=>{const t=e.currentTarget,n=u.indexOf(t),a=s[n].value;a!==l&&(c(t),i(a))},m=e=>{var t;let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=u.indexOf(e.currentTarget)+1;n=u[t]??u[0];break}case"ArrowLeft":{const t=u.indexOf(e.currentTarget)-1;n=u[t]??u[u.length-1];break}}null==(t=n)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},s.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:d},i,{className:(0,o.Z)("tabs__item",k,null==i?void 0:i.className,{"tabs__item--active":l===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:a}=e;if(t){const e=n.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},n.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function T(e){const t=f(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",g)},r.createElement(y,(0,a.Z)({},e,t)),r.createElement(v,(0,a.Z)({},e,t)))}function w(e){const t=(0,h.Z)();return r.createElement(T,(0,a.Z)({key:String(t)},e))}}}]);