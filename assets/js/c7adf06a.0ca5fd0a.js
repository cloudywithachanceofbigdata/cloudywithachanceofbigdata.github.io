"use strict";(self.webpackChunkcloudy_with_a_chance_of_big_data=self.webpackChunkcloudy_with_a_chance_of_big_data||[]).push([[7710],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),f=p(n),m=i,h=f["".concat(s,".").concat(m)]||f[m]||l[m]||r;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=f;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:i,o[1]=c;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},17587:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return p},metadata:function(){return u},assets:function(){return l},toc:function(){return f},default:function(){return h}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=n(59943),c=["components"],s={slug:"using-the-azure-cli-to-create-an-api-using-a-function-app-within-api-management",title:"Using the Azure CLI to Create an API using a Function App within API Management",authors:["jeffreyaven"],draft:!1,hide_table_of_contents:!0,image:"images/api-management-function-app.png",tags:["api-management","apis","azure","function-app","microservices","microsoft-azure","serverless"],keywords:["api-management","apis","azure","function-app","microservices","microsoft-azure","serverless"]},p=void 0,u={permalink:"/cloudywithachanceofbigdata.github.io/using-the-azure-cli-to-create-an-api-using-a-function-app-within-api-management",editUrl:"https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io/tree/main/src/blog/blog/2021-01-06-using-the-azure-cli-to-create-an-api-using-a-function-app-within-api-management/index.md",source:"@site/blog/2021-01-06-using-the-azure-cli-to-create-an-api-using-a-function-app-within-api-management/index.md",title:"Using the Azure CLI to Create an API using a Function App within API Management",description:"Function Apps, Logic Apps and App Services can be used to expose APIs within Azure API Management which is an easy way to deploy serverless microservices. You can see this capability in the Azure portal below within API Management:",date:"2021-01-06T00:00:00.000Z",formattedDate:"January 6, 2021",tags:[{label:"api-management",permalink:"/cloudywithachanceofbigdata.github.io/tags/api-management"},{label:"apis",permalink:"/cloudywithachanceofbigdata.github.io/tags/apis"},{label:"azure",permalink:"/cloudywithachanceofbigdata.github.io/tags/azure"},{label:"function-app",permalink:"/cloudywithachanceofbigdata.github.io/tags/function-app"},{label:"microservices",permalink:"/cloudywithachanceofbigdata.github.io/tags/microservices"},{label:"microsoft-azure",permalink:"/cloudywithachanceofbigdata.github.io/tags/microsoft-azure"},{label:"serverless",permalink:"/cloudywithachanceofbigdata.github.io/tags/serverless"}],readingTime:1.22,truncated:!1,authors:[{name:"Jeffrey Aven",title:"Technologist and Cloud Consultant",url:"https://www.linkedin.com/in/jeffreyaven/",imageURL:"https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80",key:"jeffreyaven"}],prevItem:{title:"Microservices Concepts: Orchestration versus Choreography",permalink:"/cloudywithachanceofbigdata.github.io/microservices-concepts-orchestration-versus-choreography"},nextItem:{title:"Great Expectations (for your data...)",permalink:"/cloudywithachanceofbigdata.github.io/great-expectations-for-your-data"}},l={authorsImageUrls:[void 0]},f=[{value:"The Solution",id:"the-solution",children:[]}],m={toc:f};function h(e){var t=e.components,s=(0,i.Z)(e,c);return(0,r.kt)("wrapper",(0,a.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Function Apps, Logic Apps and App Services can be used to expose APIs within Azure API Management which is an easy way to deploy serverless microservices. You can see this capability in the Azure portal below within API Management:"),(0,r.kt)("p",null,(0,r.kt)("a",{target:"_blank",href:n(78949).Z},(0,r.kt)("img",{alt:"Add a new API using a Function App as a back end",src:n(76712).Z}))),(0,r.kt)("p",null,"Like most readers, I like to script everything, so I was initially frustrated when I couldn\u2019t replicate this operation in the Azure cli, REST, PowerShell, or any of the other SDKs or IaC tools. Others shared my frustration as seen ",(0,r.kt)("a",{parentName:"p",href:"https://feedback.azure.com/forums/248703-api-management/suggestions/36832033-programmatically-import-azure-function-into-apim"},"here"),"."),(0,r.kt)("p",null,"I was nearly resigned to using click ops in the portal (arrrgh) before I worked out this workaround."),(0,r.kt)("h2",{id:"the-solution"},"The Solution"),(0,r.kt)("p",null,"There is a bit more prep work required to automate this process, but it is well worth it."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create an OpenApi (or Swagger spec or WADL) specification document, as seen below (use the absolute URL for your Function App in the ",(0,r.kt)("inlineCode",{parentName:"li"},"url")," parameter):")),(0,r.kt)(o.Z,{id:"077e8f313e6f44393df71057c8af7850",mdxType:"Gist"}),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"az apim api import")," function (not the ",(0,r.kt)("inlineCode",{parentName:"li"},"az apim api create")," function), as shown here:")),(0,r.kt)(o.Z,{id:"1f5eec542bd5ec01dbb9a06472e8e59b",mdxType:"Gist"}),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Associate the API with a product (which is how you can rate limit APIs)")),(0,r.kt)(o.Z,{id:"4ad9c81b97ee97fb2cb6f794c2ae820f",mdxType:"Gist"}),(0,r.kt)("p",null,"That\u2019s it! You can now access your function via the API gateway using the gateway url or via the developer portal as seen below:"),(0,r.kt)("p",null,(0,r.kt)("a",{target:"_blank",href:n(8630).Z},(0,r.kt)("img",{alt:"Function App API in API Management in the Azure Portal",src:n(185).Z}))),(0,r.kt)("p",null,(0,r.kt)("a",{target:"_blank",href:n(48675).Z},(0,r.kt)("img",{alt:"Function App API in the Dev Portal",src:n(82485).Z}))))}h.isMDXComponent=!0},78949:function(e,t,n){t.Z=n.p+"assets/files/apimamanagement-add-fnapp-a479fd5e902fc785cebfdce4e32d60d8.png"},48675:function(e,t,n){t.Z=n.p+"assets/files/apimamanagement-dev-portal-5cb59bd69af224f871a17852fcffb30e.png"},8630:function(e,t,n){t.Z=n.p+"assets/files/apimamanagement-test-api-52e41024ea9942790e112d030d65965f.png"},59943:function(e,t,n){var a=n(67294);n(45697);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var o=function(e){function t(){return i(this,t),r(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){this._updateIframeContent()},t.prototype.componentDidUpdate=function(e,t){this._updateIframeContent()},t.prototype._defineUrl=function(){var e=this.props,t=e.id,n=e.file;return"https://gist.github.com/"+t+".js"+(n?"?file="+n:"")},t.prototype._updateIframeContent=function(){var e=this.props,t=e.id,n=e.file,a=this.iframeNode,i=a.document;a.contentDocument?i=a.contentDocument:a.contentWindow&&(i=a.contentWindow.document);var r='<html><head><base target="_parent"><style>*{font-size:12px;}</style></head><body '+("onload=\"parent.document.getElementById('"+(n?"gist-"+t+"-"+n:"gist-"+t)+"').style.height=document.body.scrollHeight + 'px'\"")+">"+('<script type="text/javascript" src="'+this._defineUrl()+'"><\/script>')+"</body></html>";i.open(),i.writeln(r),i.close()},t.prototype.render=function(){var e=this,t=this.props,n=t.id,i=t.file;return a.createElement("iframe",{ref:function(t){e.iframeNode=t},width:"100%",frameBorder:0,id:i?"gist-"+n+"-"+i:"gist-"+n})},t}(a.PureComponent);t.Z=o},76712:function(e,t,n){t.Z=n.p+"assets/images/apimamanagement-add-fnapp-a479fd5e902fc785cebfdce4e32d60d8.png"},82485:function(e,t,n){t.Z=n.p+"assets/images/apimamanagement-dev-portal-5cb59bd69af224f871a17852fcffb30e.png"},185:function(e,t,n){t.Z=n.p+"assets/images/apimamanagement-test-api-52e41024ea9942790e112d030d65965f.png"}}]);