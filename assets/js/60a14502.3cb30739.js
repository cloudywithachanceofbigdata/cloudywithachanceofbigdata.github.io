"use strict";(self.webpackChunkfull_stack_chronicles=self.webpackChunkfull_stack_chronicles||[]).push([[73631],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(a),m=o,f=p["".concat(l,".").concat(m)]||p[m]||u[m]||i;return a?n.createElement(f,r(r({ref:t},d),{},{components:a})):n.createElement(f,r({ref:t},d))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},43032:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=a(83117),o=(a(67294),a(3905)),i=a(59943);const r={slug:"s3-object-notifications-using-lambda-and-ses",title:"S3 Object Notifications using Lambda and SES",authors:["jeffreyaven"],draft:!1,hide_table_of_contents:!0,description:"Simple pattern for formatted emails from S3 object notifications using AWS Lambda and SES, built with Terraform and Python",image:"images/s3-object-notifications-using-Lambda-and-SES-with-Terraform.png",tags:["aws","boto3","lambda","python","s3","ses","terraform"],keywords:["aws","boto3","lambda","python","s3","ses","terraform"]},s=void 0,l={permalink:"/s3-object-notifications-using-lambda-and-ses",editUrl:"https://github.com/stackql/fullstackchronicles.io/edit/main/src/blog/2019-01-18-s3-object-notifications-using-lambda-and-ses/index.md",source:"@site/blog/2019-01-18-s3-object-notifications-using-lambda-and-ses/index.md",title:"S3 Object Notifications using Lambda and SES",description:"Simple pattern for formatted emails from S3 object notifications using AWS Lambda and SES, built with Terraform and Python",date:"2019-01-18T00:00:00.000Z",formattedDate:"January 18, 2019",tags:[{label:"aws",permalink:"/tags/aws"},{label:"boto3",permalink:"/tags/boto-3"},{label:"lambda",permalink:"/tags/lambda"},{label:"python",permalink:"/tags/python"},{label:"s3",permalink:"/tags/s-3"},{label:"ses",permalink:"/tags/ses"},{label:"terraform",permalink:"/tags/terraform"}],readingTime:2.055,hasTruncateMarker:!1,authors:[{name:"Jeffrey Aven",title:"Technologist and Cloud Consultant",url:"https://www.linkedin.com/in/jeffreyaven/",imageURL:"https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80",key:"jeffreyaven"}],frontMatter:{slug:"s3-object-notifications-using-lambda-and-ses",title:"S3 Object Notifications using Lambda and SES",authors:["jeffreyaven"],draft:!1,hide_table_of_contents:!0,description:"Simple pattern for formatted emails from S3 object notifications using AWS Lambda and SES, built with Terraform and Python",image:"images/s3-object-notifications-using-Lambda-and-SES-with-Terraform.png",tags:["aws","boto3","lambda","python","s3","ses","terraform"],keywords:["aws","boto3","lambda","python","s3","ses","terraform"]},prevItem:{title:"Test Driven Infrastructure and Test Automation with Ansible, Molecule and Azure",permalink:"/test-driven-infrastructure-and-test-automation-with-ansible-molecule-and-azure"},nextItem:{title:"Infrastructure Automation using AWS Lambda",permalink:"/infrastructure-automation-using-aws-lambda"}},c={authorsImageUrls:[void 0]},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Deployment",id:"deployment",level:2}],u={toc:d};function p(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"S3 object notifications using Lambda and SES with Terraform",src:a(77723).Z,width:"353",height:"257"})),(0,o.kt)("p",null,"Following on from the previous post in the Really Simple Terraform series ",(0,o.kt)("a",{parentName:"p",href:"https://cloudywithachanceofbigdata.com/really-simple-terraform-infrastructure-automation-using-aws-lambda/"},"simple-lambda-ec2-scheduler"),", where we used Terraform to deploy a Lambda function including the packaging of the Python function into a ZIP archive and creation of all supporting objects (roles, policies, permissions, etc) \u2013 in this post we will take things a step further by using templating to update parameters in the Lambda function code before the packaging and creation of the Lambda function."),(0,o.kt)("p",null,"S3 event notifications can be published directly to an SNS topic which you could create an email subscription, this is quite straightforward. However the email notifications you get look something like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Email Notification sent via an SNS Topic Subscription",src:a(45389).Z,width:"1056",height:"593"})),(0,o.kt)("p",null,"There is very little you can do about this."),(0,o.kt)("p",null,"However if you take a slightly different approach by triggering a Lambda function to send an email via SES you have much more control over content and formatting. Using this approach you could get an email notification that looks like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Email Notification sent using Lambda and SES",src:a(11419).Z,width:"643",height:"714"})),(0,o.kt)("p",null,"Much easier on the eye!"),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"You will need verified AWS SES (Simple Email Service) email addresses for the sender and recipient\u2019s addresses used for your object notification emails. This can be done via the console as shown here:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"SES Email Address Verification",src:a(13160).Z,width:"1126",height:"801"})),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Note that SES is not available in every AWS region, pick one that is generally closest to your particular reason (but it really doesn't matter for this purpose).")),(0,o.kt)("h2",{id:"deployment"},"Deployment"),(0,o.kt)("p",null,"The Terraform module creates an IAM Role and associated policy for the Lambda function as shown here:"),(0,o.kt)(i.Z,{id:"023fab404c0df759d6d1d4bdb02ab4e8",mdxType:"Gist"}),(0,o.kt)("p",null,"Variables in the module are substituted into the function code template, the rendered template file is then packaged as a ZIP archive to be uploaded as the Lambda function source as shown here:"),(0,o.kt)(i.Z,{id:"7d72d8c67114a9df0af1528a3b754d9e",mdxType:"Gist"}),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"As in the previous post, I will reiterate that although Terraform is technically not a build tool, it can be used for simple build operations such as this.")),(0,o.kt)("p",null,"The Lambda function is deployed using the following code:"),(0,o.kt)(i.Z,{id:"5e7f2a238e8e0270cd55def40a389903",mdxType:"Gist"}),(0,o.kt)("p",null,"Finally the S3 object notification events are configured as shown here:"),(0,o.kt)(i.Z,{id:"e7de65f20c79e0efb115024597864a75",mdxType:"Gist"}),(0,o.kt)("p",null,"Use the following commands to run this example (I have created a default credentials profile, but you could supply your API credentials directly, use STS, etc):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd simple-notifications-with-lambda-and-ses\nterraform init\nterraform apply\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},"Full source code can be found at: ",(0,o.kt)("a",{parentName:"em",href:"https://github.com/avensolutions/simple-notifications-with-lambda-and-ses"},(0,o.kt)("strong",{parentName:"a"},"https://github.com/avensolutions/simple-notifications-with-lambda-and-ses"))))))}p.isMDXComponent=!0},59943:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(67294);a(45697);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}const r=function(e){function t(){return o(this,t),i(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){this._updateIframeContent()},t.prototype.componentDidUpdate=function(e,t){this._updateIframeContent()},t.prototype._defineUrl=function(){var e=this.props,t=e.id,a=e.file;return"https://gist.github.com/"+t+".js"+(a?"?file="+a:"")},t.prototype._updateIframeContent=function(){var e=this.props,t=e.id,a=e.file,n=this.iframeNode,o=n.document;n.contentDocument?o=n.contentDocument:n.contentWindow&&(o=n.contentWindow.document);var i='<html><head><base target="_parent"><style>*{font-size:12px;}</style></head><body '+("onload=\"parent.document.getElementById('"+(a?"gist-"+t+"-"+a:"gist-"+t)+"').style.height=document.body.scrollHeight + 'px'\"")+">"+('<script type="text/javascript" src="'+this._defineUrl()+'"><\/script>')+"</body></html>";o.open(),o.writeln(i),o.close()},t.prototype.render=function(){var e=this,t=this.props,a=t.id,o=t.file;return n.createElement("iframe",{ref:function(t){e.iframeNode=t},width:"100%",frameBorder:0,id:o?"gist-"+a+"-"+o:"gist-"+a})},t}(n.PureComponent)},77723:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/s3-object-notifications-using-Lambda-and-SES-with-Terraform-3caec5211828aa843515f4004a922eba.png"},11419:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/ses-object-notification-email-f2ec2abb7f361ac49d08d5b54ac369ad.png"},13160:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/ses-verify-67af4f0a0493eddb21c1500407857016.png"},45389:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sns-object-notification-email-173693c0618474107c4e13e72ea5e805.png"}}]);