<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Cloudy with a chance of Big Data Blog Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Cloudy with a chance of Big Data Blog Feed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Cloudy with a chance of Big Data Blog Feed JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4N6KSJ2G0P"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4N6KSJ2G0P",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Cloudy with a chance of Big Data" href="/opensearch.xml"><title data-react-helmet="true">2 posts tagged with &quot;multi-cloud&quot; | Cloudy with a chance of Big Data</title><meta data-react-helmet="true" property="og:title" content="2 posts tagged with &quot;multi-cloud&quot; | Cloudy with a chance of Big Data"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://cloudywithachanceofbigdata.com/tags/multi-cloud"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cloudywithachanceofbigdata.com/tags/multi-cloud"><link data-react-helmet="true" rel="alternate" href="https://cloudywithachanceofbigdata.com/tags/multi-cloud" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cloudywithachanceofbigdata.com/tags/multi-cloud" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.fe05d8b3.css">
<link rel="preload" href="/assets/js/runtime~main.711097e0.js" as="script">
<link rel="preload" href="/assets/js/main.fe6a2a08.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#A9BCD0;color:#1A4E82" role="banner"><div class="announcementBarContent_KsVm"><b>If you find our content useful, give it a ‚≠êÔ∏è on <a target="_blank" rel="noopener noreferrer" href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io">GitHub</a>, if you want to contribute and become an author, submit a PR</b></div></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Cloudy with a chance of Big Data</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/tags">Topics</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/tags">All Topics</a></li><li><a class="dropdown__link" href="/tags/gcp">Google Cloud Platform</a></li><li><a class="dropdown__link" href="/tags/aws">AWS</a></li><li><a class="dropdown__link" href="/tags/azure">Azure</a></li><li><a class="dropdown__link" href="/tags/ci-cd">CI/CD</a></li></ul></div><a class="navbar__item navbar__link" href="/archive">Archive</a><a href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">üåú</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">üåû</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/converting-to-local-time-in-aws-lambda-using-nodejs">Converting to local time in AWS Lambda using Node.js</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/automating-snowflake-role-based-storage-integration-for-aws">Automating Snowflake Role Based Storage Integration for AWS</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/simplifying-large-cloudformation-templates-using-jsonnet">Simplifying Large CloudFormation Templates using Jsonnet</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/aws-deployments-with-cloudformation-and-gitlab-ci">Simplified AWS Deployments with CloudFormation and GitLab CI</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/from-wordpress-to-jamstack">From Wordpress to Jamstack</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/using-jsonnet-to-configure-multiple-environments">Using Jsonnet to Configure Multiple Environments</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/use-bigquery-to-trigger-cloud-run">Use BigQuery to trigger Cloud Run</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/azure-static-web-app-review">Azure Static Web App Review</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/introducing-the-metadata-hub-mdh">Introducing the Metadata Hub (MDH)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/masking-private-keys-in-ci-cd-pipelines-in-gitlab">Masking Private Keys in CI/CD Pipelines in GitLab</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;multi-cloud&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/multi-cloud-diagramming-with-plantuml">Multi Cloud Diagramming with PlantUML</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-10-26T00:00:00.000Z" itemprop="datePublished">October 26, 2020</time> ¬∑ <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://cloudywithachanceofbigdata.com/images/multicloud.png"><div class="markdown" itemprop="articleBody"><p>Following on from the recent post <a href="https://cloudywithachanceofbigdata.com/gcp-templates-for-c4-diagrams-using-plantuml/" target="_blank" rel="noopener noreferrer">GCP Templates for C4 Diagrams using PlantUML</a>, cloud architects are often challenged with producing diagrams for architectures spanning multiple cloud providers, particularly as you elevate to enterprise level diagrams.</p><p>In this post, with the magic of <code>!includeurl</code> we have brought PlantUML template libraries together for AWS, Azure and GCP icon sets, allowing us to produce multi cloud C4 diagrams using PlantUML like this one:</p><p><a target="_blank" href="/assets/files/Example-Multi-Cloud-PlantUML-C4-Diagram-8695466addda79c4432fca63824ab2eb.png"><img alt="Multi Cloud Architecture Diagram using PlantUML" src="/assets/images/Example-Multi-Cloud-PlantUML-C4-Diagram-8695466addda79c4432fca63824ab2eb.png" width="1224" height="760"></a></p><p>Creating a multi cloud diagram is simple, start by adding the following <code>include</code> statements after the <code>@startuml</code> label in a new PlantUML C4 diagram:</p><iframe width="100%" frameborder="0" id="gist-5319b6b041f8b8f54c922a9a5b9b6e7c"></iframe><p>Then add references to the required services from different providers‚Ä¶</p><iframe width="100%" frameborder="0" id="gist-6ed55cd1b4e3b2e7027f8236af4aa112"></iframe><p>Then include the predefined resources from your different cloud providers in your diagram as shown here (describing a client server application over a cloud to cloud VPN between Azure and GCP)...</p><iframe width="100%" frameborder="0" id="gist-600aecff7094d7843771770b7048cb2c"></iframe><p>Happy multi-cloud diagramming!</p><blockquote><p>Full source code is available at:</p><p><a href="https://github.com/gamma-data/plantuml-multi-cloud-diagrams" target="_blank" rel="noopener noreferrer">https://github.com/gamma-data/plantuml-multi-cloud-diagrams</a></p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/amazonwebservices">amazonwebservices</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/aws">aws</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/azure">azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/c-4-model">c4model</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/diagramming">diagramming</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/gcp">gcp</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/google-cloud-platform">google-cloud-platform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/googlecloudplatform">googlecloudplatform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microsoft-azure">microsoft-azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/multi-cloud">multi-cloud</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/plantuml">plantuml</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/software-architecture">software-architecture</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Multi Cloud Diagramming with PlantUML" href="/multi-cloud-diagramming-with-plantuml"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/creating-a-site-to-site-vpn-connection-between-gcp-and-azure-with-google-private-access">Creating a Site to Site VPN Connection Between GCP and Azure with Google Private Access</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-03-27T00:00:00.000Z" itemprop="datePublished">March 27, 2020</time> ¬∑ <!-- -->12 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://cloudywithachanceofbigdata.com/images/azure_to_gcp_feature_image-1.png"><div class="markdown" itemprop="articleBody"><p>This article demonstrates creating a site to site IPSEC VPN connection between a GCP VPC network and an Azure Virtual Network, enabling private RFC1918 network connectivity between virtual networks in both clouds. This is done using a single PowerShell script leveraging Azure PowerShell and gcloud commands in the Google SDK.</p><p>Additionally, we will use Azure Private DNS to enable private access between Azure hosts and GCP APIs (such as Cloud Storage or Big Query).</p><p>An overview of the solution is provided here:</p><p><a target="_blank" href="/assets/files/gcp-to-azure-vpn-design-f59e466042c5e6fdf12abc497dde73bd.png"><img alt="Azure to GCP VPN Design" src="/assets/images/gcp-to-azure-vpn-design-f59e466042c5e6fdf12abc497dde73bd.png" width="3572" height="2407"></a></p><p>One note before starting - site to site VPN connections between GCP and Azure currently do not support dynamic routing using BGP, however creating some simple routes on either end of the connection will be enough to get going.</p><p>Let‚Äôs go through this step by step:</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-1--authenticate-to-azure">Step 1 : Authenticate to Azure<a class="hash-link" href="#step-1--authenticate-to-azure" title="Direct link to heading">‚Äã</a></h2><p>Azure‚Äôs account equivalent is a subscription, the following command from Azure Powershell is used to authenticate a user to one or more subscriptions.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Connect-AzAccount</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This command will open a browser window prompting you for Microsoft credentials, once authenticated you will be returned to the command line.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-2--create-a-resource-group-azure">Step 2 : Create a Resource Group (Azure)<a class="hash-link" href="#step-2--create-a-resource-group-azure" title="Direct link to heading">‚Äã</a></h2><p>A resource group is roughly equivalent to a project in GCP. You will need to supply a Location (equivalent to a GCP region):</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">New-AzResourceGroup `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-3--create-a-virtual-network-with-subnets-and-routes-azure">Step 3 : Create a Virtual Network with Subnets and Routes (Azure)<a class="hash-link" href="#step-3--create-a-virtual-network-with-subnets-and-routes-azure" title="Direct link to heading">‚Äã</a></h2><p>An Azure Virtual Network is the equivalent of a VPC network in GCP (or AWS), you must define subnets before creating a Virtual Network. In this example we will create two subnets, one Gateway subnet (which needs to be named accordingly) where the VPN gateway will reside, and one subnet named ‚Äòdefault‚Äô where we will host VMs which will connect to GCP services over the private VPN connection.</p><p>Before defining the default subnet we must create and attach a Route Table (equivalent of a Route in GCP), this particular route will be used to route ‚Äòprivate‚Äô requests to services in GCP (such as Big Query).</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># define route table and route to GCP private access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$azroutecfg = New-AzRouteConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;google-private&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AddressPrefix &quot;199.36.153.4/30&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -NextHopType &quot;VirtualNetworkGateway&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$azrttbl = New-AzRouteTable `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;google-private&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Route $azroutecfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># define gateway subnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$gatewaySubnet = New-AzVirtualNetworkSubnetConfig  `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;GatewaySubnet&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AddressPrefix &quot;10.1.2.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># define default subnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$defaultSubnet  = New-AzVirtualNetworkSubnetConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;default&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AddressPrefix &quot;10.1.1.0/24&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -RouteTable $azrttbl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create virtual network and subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$vnet = New-AzVirtualNetwork  `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;azure-to-gcp-vnet&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AddressPrefix &quot;10.1.0.0/16&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Subnet $gatewaySubnet,$defaultSubnet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-4--create-network-security-groups-azure">Step 4 : Create Network Security Groups (Azure)<a class="hash-link" href="#step-4--create-network-security-groups-azure" title="Direct link to heading">‚Äã</a></h2><p>Network Security Groups in Azure are stateful firewalls much like Firewall Rules in VPC networks in GCP. Like GCP, the lower priority overrides higher priority rules.</p><p>In the example we will create several rules to allow inbound ICMP, TCP and UDP traffic from our Google VPC and RDP traffic from the Internet (which we will use to logon to a VM in Azure to test private connectivity between the two clouds):</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create network security group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$rule1 = New-AzNetworkSecurityRuleConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name rdp-rule `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Description &quot;Allow RDP&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Access Allow `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Protocol Tcp `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Direction Inbound `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Priority 100 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SourceAddressPrefix Internet `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SourcePortRange * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -DestinationAddressPrefix * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -DestinationPortRange 3389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$rule2 = New-AzNetworkSecurityRuleConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name icmp-rule `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Description &quot;Allow ICMP&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Access Allow `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Protocol Icmp `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Direction Inbound `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Priority 101 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SourceAddressPrefix * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SourcePortRange * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -DestinationAddressPrefix * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -DestinationPortRange *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$rule3 = New-AzNetworkSecurityRuleConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name gcp-rule `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Description &quot;Allow GCP&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Access Allow `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Protocol Tcp `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Direction Inbound `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Priority 102 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SourceAddressPrefix &quot;10.2.0.0/16&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SourcePortRange * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -DestinationAddressPrefix * `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -DestinationPortRange *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$nsg = New-AzNetworkSecurityGroup `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;nsg-vm&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SecurityRules $rule1,$rule2,$rule3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-5--create-public-ip-addresses-azure">Step 5 : Create Public IP Addresses (Azure)<a class="hash-link" href="#step-5--create-public-ip-addresses-azure" title="Direct link to heading">‚Äã</a></h2><p>We need to create two Public IP Address (equivalent of an External IP in GCP) which will be used for our VPN gateway and for the VM we will create:</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create public IP address for VM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$vmpip = New-AzPublicIpAddress `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;vm-ip&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AllocationMethod Dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create public IP address for NW gateway </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ngwpip = New-AzPublicIpAddress `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;ngw-ip&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AllocationMethod Dynamic</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-6--create-virtual-network-gateway-azure">Step 6 : Create Virtual Network Gateway (Azure)<a class="hash-link" href="#step-6--create-virtual-network-gateway-azure" title="Direct link to heading">‚Äã</a></h2><p>The Virtual Network Gateway in Azure is the VPN Gateway equivalent in Azure which will be used to create a VPN tunnel between Azure and a GCP VPN Gateway. This gateway will be placed in the Gateway subnet created previously and one of the Public IP addresses created in the previous step will be assigned to this gateway.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create virtual network gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ngwipconfig = New-AzVirtualNetworkGatewayIpConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;ngw-ipconfig&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SubnetId $gatewaySubnet.Id `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -PublicIpAddressId $ngwpip.Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># use the AsJob switch as this is a long running process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$job = New-AzVirtualNetworkGateway -Name &quot;vnet-gateway&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -IpConfigurations $ngwipconfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -GatewayType &quot;Vpn&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VpnType &quot;RouteBased&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -GatewaySku &quot;VpnGw1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VpnGatewayGeneration &quot;Generation1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AsJob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$vnetgw = Get-AzVirtualNetworkGateway `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;vnet-gateway&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-7--create-a-vpc-network-and-subnetworks-gcp">Step 7 : Create a VPC Network and Subnetwork(s) (GCP)<a class="hash-link" href="#step-7--create-a-vpc-network-and-subnetworks-gcp" title="Direct link to heading">‚Äã</a></h2><p>A VPC network and subnet need to be created in GCP, the subnet defines the VPC address space. This address space must not overlap with the Azure Virtual Network CIDR. For all GCP steps it is assumed that the project is set for client config (e.g. gcloud config set project <strong>your_project</strong>) so it does not need to be specified for each operation. Private Google access should be enabled on all subnets created.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># creating VPC network and subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute networks create &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --subnet-mode=custom `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --bgp-routing-mode=regional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute networks subnets create &quot;aus-subnet&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network  &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --range &quot;10.2.1.0/24&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-private-ip-google-access</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-8--create-an-external-ip-gcp">Step 8 : Create an External IP (GCP)<a class="hash-link" href="#step-8--create-an-external-ip-gcp" title="Direct link to heading">‚Äã</a></h2><p>An external IP address will need to be created in GCP which will be used for the external facing interface of the VPN Gateway.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># create external IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute addresses create </span><span class="token string" style="color:#e3116c">&quot;ext-gw-ip&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  --region </span><span class="token variable string" style="color:#e3116c">&quot;australia-southeast1&quot;</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="display:inline-block;color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">$gcp_ipaddr_obj </span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa"> gcloud compute addresses describe </span><span class="token variable string" style="color:#e3116c">&quot;ext-gw-ip&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region </span><span class="token string" style="color:#e3116c">&quot;australia-southeast1&quot;</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --format json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ConvertFrom-Json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$gcp_ipaddr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$gcp_ipaddr_obj</span><span class="token plain">.address</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-9--create-firewall-rules-gcp">Step 9 : Create Firewall Rules (GCP)<a class="hash-link" href="#step-9--create-firewall-rules-gcp" title="Direct link to heading">‚Äã</a></h2><p>VPC firewall rules will need to be created in GCP to allow VPN traffic as well as SSH traffic from the internet (which allows you to SSH into VM instances using Cloud Shell).</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create VPN firewall rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute firewall-rules create &quot;vpn-rule1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --allow tcp,udp,icmp `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --source-ranges &quot;10.1.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute firewall-rules create &quot;ssh-rule1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --allow tcp:22</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-10--create-vpn-gateway-and-forwarding-rules-gcp">Step 10 : Create VPN Gateway and Forwarding Rules (GCP)<a class="hash-link" href="#step-10--create-vpn-gateway-and-forwarding-rules-gcp" title="Direct link to heading">‚Äã</a></h2><p>Create a VPN Gateway and Forwarding Rules in GCP which will be used to create a tunnel between GCP and Azure.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create cloud VPN </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute target-vpn-gateways create &quot;vpn-gw&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create forwarding rule ESP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute forwarding-rules create &quot;fr-gw-name-esp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ip-protocol ESP `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --address &quot;ext-gw-ip&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --target-vpn-gateway &quot;vpn-gw&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># creating forwarding rule UDP500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute forwarding-rules create &quot;fr-gw-name-udp500&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ip-protocol UDP `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ports 500 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --address &quot;ext-gw-ip&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --target-vpn-gateway &quot;vpn-gw&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># creating forwarding rule UDP4500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute forwarding-rules create &quot;fr-gw-name-udp4500&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ip-protocol UDP `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ports 4500 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --address &quot;ext-gw-ip&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --target-vpn-gateway &quot;vpn-gw&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-10--create-vpn-tunnel-gcp-side">Step 10 : Create VPN Tunnel (GCP Side)<a class="hash-link" href="#step-10--create-vpn-tunnel-gcp-side" title="Direct link to heading">‚Äã</a></h2><p>Now we will create the GCP side of our VPN tunnel using the Public IP Address of the Azure Virtual Network Gateway created in a previous step. As this example uses a route based VPN the traffic selector values need to be set at 0.0.0.0/0. A PSK (Pre Shared Key) needs to be supplied which will be the same key used when we configure a VPN Connection on the Azure side of the tunnel.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># get peer public IP address of Azure gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$azpubip = Get-AzPublicIpAddress `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;ngw-ip&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create VPN tunnel </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute vpn-tunnels create &quot;vpn-tunnel-to-azure&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --peer-address $azpubip.IpAddress `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --local-traffic-selector &quot;0.0.0.0/0&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --remote-traffic-selector &quot;0.0.0.0/0&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ike-version 2 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --shared-secret &lt;&lt; Pre-Shared Key &gt;&gt; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --target-vpn-gateway &quot;vpn-gw&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region  &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-11--create-static-routes-gcp-side">Step 11 : Create Static Routes (GCP Side)<a class="hash-link" href="#step-11--create-static-routes-gcp-side" title="Direct link to heading">‚Äã</a></h2><p>As we are using static routing (as opposed to dynamic routing) we will need to define all of the specific routes on the GCP side. We will need to setup routes for both outgoing traffic to the Azure network as well as incoming traffic for the restricted Google API range (199.36.153.4/30).</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create static route (VPN)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute routes create &quot;route-to-azure&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --destination-range &quot;10.1.0.0/16&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --next-hop-vpn-tunnel &quot;vpn-tunnel-to-azure&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --next-hop-vpn-tunnel-region &quot;australia-southeast1&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create static route (Restricted APIs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute routes create apis `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network  &quot;azure-to-gcp-vpc&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --destination-range &quot;199.36.153.4/30&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --next-hop-gateway default-internet-gateway `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project &quot;azure-to-gcp-project&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-12--create-a-local-gateway-azure">Step 12 : Create a Local Gateway (Azure)<a class="hash-link" href="#step-12--create-a-local-gateway-azure" title="Direct link to heading">‚Äã</a></h2><p>A Local Gateway in Azure is an object that represents the remote gateway (GCP VPN gateway).</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create local gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$azlocalgw = New-AzLocalNetworkGateway `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;local-gateway&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -GatewayIpAddress $gcp_ipaddr `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AddressPrefix &quot;10.2.0.0/16&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-13--create-a-vpn-connection-azure">Step 13 : Create a VPN Connection (Azure)<a class="hash-link" href="#step-13--create-a-vpn-connection-azure" title="Direct link to heading">‚Äã</a></h2><p>Now we can setup the Azure side of the VPN Connection which is accomplished by associating the Azure Virtual Network Gateway with the Local Network Gateway. A PSK (Pre Shared Key) needs to be supplied which is the same key used for the GCP VPN Tunnel in step 10.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$azvpnconn = New-AzVirtualNetworkGatewayConnection `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;vpn-connection&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VirtualNetworkGateway1 $vnetgw `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -LocalNetworkGateway2 $azlocalgw `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ConnectionType IPsec `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SharedKey  &lt;&lt; Pre-Shared Key &gt;&gt;  `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ConnectionProtocol &quot;IKEv2&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>VPN Tunnel Established!</p><p>At this stage we have created an end to end connection between the virtual networks in both clouds. You should see this reflected in the respective consoles in each provider.</p><figure><a href="/assets/images/gcp-vpn-to-azure-d627caa8febd797b530e1471bd5c9aff.png"><img src="/assets/images/gcp-vpn-to-azure-d627caa8febd797b530e1471bd5c9aff.png" alt="GCP VPN Tunnel to a Azure Virtual Network"></a><figcaption class="figure-caption">GCP VPN Tunnel to a Azure Virtual Network</figcaption></figure><figure><a href="/assets/images/azure-vpn-to-gcp-4716124e93f2cbc8a7e5ef5cd98d23df.png"><img src="/assets/images/azure-vpn-to-gcp-4716124e93f2cbc8a7e5ef5cd98d23df.png" alt="Azure VPN Connection to a GCP VPC Network"></a><figcaption class="figure-caption">Azure VPN Connection to a GCP VPC Network</figcaption></figure><p>Congratulations! You have just setup a multi cloud environment using private networking. Now let‚Äôs setup Google Private Access for Azure hosts and create VMs on each side to test our setup.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-14--create-a-private-dns-zone-for-googleapiscom-azure">Step 14 : Create a Private DNS Zone for googleapis.com (Azure)<a class="hash-link" href="#step-14--create-a-private-dns-zone-for-googleapiscom-azure" title="Direct link to heading">‚Äã</a></h2><p>We will now need to create a Private DNS zone in Azure for the googleapis.com domain which will host records to redirect Google API requests to the Restricted API range.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create private DNS zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New-AzPrivateDnsZone `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;googleapis.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add A Records   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records = @()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records += New-AzPrivateDnsRecordConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -IPv4Address 199.36.153.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records += New-AzPrivateDnsRecordConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -IPv4Address 199.36.153.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records += New-AzPrivateDnsRecordConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -IPv4Address 199.36.153.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records += New-AzPrivateDnsRecordConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -IPv4Address 199.36.153.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New-AzPrivateDnsRecordSet `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;restricted&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -RecordType A `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -TTL 300 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ZoneName &quot;googleapis.com&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -PrivateDnsRecords $Records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add CNAME Records   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records = @()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Records += New-AzPrivateDnsRecordConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Cname &quot;restricted.googleapis.com.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New-AzPrivateDnsRecordSet `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;*&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -RecordType CNAME `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -TTL 300 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ZoneName &quot;googleapis.com&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -PrivateDnsRecords $Records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create VNet Link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New-AzPrivateDnsVirtualNetworkLink `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ZoneName &quot;googleapis.com&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;dns-zone-link&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VirtualNetworkId $vnet.Id</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-15--create-a-virtual-machine-azure">Step 15 : Create a Virtual Machine (Azure)<a class="hash-link" href="#step-15--create-a-virtual-machine-azure" title="Direct link to heading">‚Äã</a></h2><p>We will create a VM in Azure which we can use to test the VPN tunnel as well as to test Private Google Access over our VPN tunnel.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create VM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$az_vmlocaladminpwd = ConvertTo-SecureString &lt;&lt; Password Param &gt;&gt; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -AsPlainText -Force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$Credential = New-Object System.Management.Automation.PSCredential  (&quot;LocalAdminUser&quot;, $az_vmlocaladminpwd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$nic = New-AzNetworkInterface `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Name &quot;vm-nic&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -SubnetId $defaultSubnet.Id `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -NetworkSecurityGroupId $nsg.Id `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -PublicIpAddressId $vmpip.Id `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -EnableAcceleratedNetworking `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$VirtualMachine = New-AzVMConfig `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VMName &quot;windows-desktop&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VMSize &quot;Standard_D4_v3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$VirtualMachine = Set-AzVMOperatingSystem `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VM $VirtualMachine `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Windows `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ComputerName  &quot;windows-desktop&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Credential $Credential `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ProvisionVMAgent `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -EnableAutoUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$VirtualMachine = Add-AzVMNetworkInterface `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VM $VirtualMachine `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Id $nic.Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$VirtualMachine = Set-AzVMSourceImage `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VM $VirtualMachine `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -PublisherName &#x27;MicrosoftWindowsDesktop&#x27; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Offer &#x27;Windows-10&#x27; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Skus &#x27;rs5-pro&#x27; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Version latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New-AzVM `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ResourceGroupName &quot;azure-to-gcp&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Location &quot;Australia Southeast&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -VM $VirtualMachine `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Verbose</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-16--create-a-vm-instance-gcp">Step 16 : Create a VM Instance (GCP)<a class="hash-link" href="#step-16--create-a-vm-instance-gcp" title="Direct link to heading">‚Äã</a></h2><p>We will create a Linux VM in GCP to test connectivity to hosts in Azure using the VPN tunnel we have established.</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># create VM instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute instances create &quot;gcp-instance&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --zone &quot;australia-southeast1-b&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --machine-type &quot;f1-micro&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --subnet &quot;aus-subnet&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network-tier PREMIUM `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --maintenance-policy MIGRATE `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --image=debian-9-stretch-v20200309 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --image-project=debian-cloud `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --boot-disk-size 10GB `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --boot-disk-type pd-standard `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --boot-disk-device-name instance-1 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --reservation-affinity any</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="test-connectivity">Test Connectivity<a class="hash-link" href="#test-connectivity" title="Direct link to heading">‚Äã</a></h2><p>Now we are ready to test connectivity from both sides of the tunnel.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="azure-to-gcp">Azure to GCP<a class="hash-link" href="#azure-to-gcp" title="Direct link to heading">‚Äã</a></h3><p>Establish a remote desktop (RDP) connection to the Azure VM created in Step 15. Ping the GCP VM instance using its private IP address.</p><p><a target="_blank" href="/assets/files/azure-ping-to-gcp-14a9b0e446b7c868ffa27ba3435460be.png"><img alt="Test Private IP Connectivity from Azure to GCP" src="/assets/images/azure-ping-to-gcp-14a9b0e446b7c868ffa27ba3435460be.png" width="1635" height="967"></a></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="gcp-to-azure">GCP to Azure<a class="hash-link" href="#gcp-to-azure" title="Direct link to heading">‚Äã</a></h3><p>Now SSH into the GCP Linux VM instance and ping the Azure host using its private IP address.</p><p><a target="_blank" href="/assets/files/gcp-ping-to-azure-94b9a33840b54870af540853cda825e9.png"><img alt="Test Private IP Connectivity from GCP to Azure" src="/assets/images/gcp-ping-to-azure-94b9a33840b54870af540853cda825e9.png" width="902" height="710"></a></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="test-private-google-access-from-azure">Test Private Google Access from Azure<a class="hash-link" href="#test-private-google-access-from-azure" title="Direct link to heading">‚Äã</a></h2><p>Now that we have established bi-directional connectivity between the two clouds, we can test private access to Google APIs from our Azure host. Follow the steps below to test private access:</p><ol><li>RDP into the Azure VM</li><li>Install the Google Cloud SDK ( <a href="https://cloud.google.com/sdk/" target="_blank" rel="noopener noreferrer">https://cloud.google.com/sdk/</a>)</li><li>Perform an <code>nslookup</code> to ensure that calls to googleapis.com resolve to the restricted API range (e.g. <code>nslookup storage.googleapis.com</code>). You should see a response showing the A records from the googleapis.com Private DNS Zone created in step 14.</li><li>Now test connectivity to Google APIs, for example to test access to Google Cloud Storage using <code>gsutil</code>, or test access to Big Query using the <code>bq</code> command</li></ol><p>Congratulations! You are now a multi cloud ninja!</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/azure">azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/gcp">gcp</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/google-cloud-platform">google-cloud-platform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/googlecloudplatform">googlecloudplatform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/hybrid-cloud">hybrid-cloud</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microsoft">microsoft</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microsoft-azure">microsoft-azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/multi-cloud">multi-cloud</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/private-networking">private-networking</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/vpn">vpn</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Creating a Site to Site VPN Connection Between GCP and Azure with Google Private Access" href="/creating-a-site-to-site-vpn-connection-between-gcp-and-azure-with-google-private-access"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a href="https://stackql.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>StackQL<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gammadata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gamma Data<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.windrate.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>WindRate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.711097e0.js"></script>
<script src="/assets/js/main.fe6a2a08.js"></script>
</body>
</html>