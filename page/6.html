<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Full Stack Chronicles Blog Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Full Stack Chronicles Blog Feed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Full Stack Chronicles Blog Feed JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0FVDC1E8G6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0FVDC1E8G6",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Full Stack Chronicles" href="/opensearch.xml"><title data-rh="true">Full Stack Chronicles | Full Stack Chronicles</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://fullstackchronicles.io/img/fullstackchronicles-cover-image.png"><meta data-rh="true" name="twitter:image" content="https://fullstackchronicles.io/img/fullstackchronicles-cover-image.png"><meta data-rh="true" property="og:url" content="https://fullstackchronicles.io/page/6"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="wot-verification" content="e7522390be4370727fac"><meta data-rh="true" property="og:title" content="Full Stack Chronicles | Full Stack Chronicles"><meta data-rh="true" name="description" content="Full stack design patterns and random musings"><meta data-rh="true" property="og:description" content="Full stack design patterns and random musings"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fullstackchronicles.io/page/6"><link data-rh="true" rel="alternate" href="https://fullstackchronicles.io/page/6" hreflang="en"><link data-rh="true" rel="alternate" href="https://fullstackchronicles.io/page/6" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://MZCGVO503N-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.77ea11e8.css">
<link rel="preload" href="/assets/js/runtime~main.15fd567d.js" as="script">
<link rel="preload" href="/assets/js/main.6d1825e7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#A9BCD0;color:#1A4E82" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm"><b>If you find our content useful, give it a ⭐️ on <a target="_blank" rel="noopener noreferrer" href="https://github.com/stackql/fullstackchronicles.io">GitHub</a>, if you want to contribute and become an author, submit a PR</b></div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2 navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/full-stack-logo-transparent.svg" alt="Full Stack Chronicles" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/full-stack-logo-transparent.svg" alt="Full Stack Chronicles" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Full Stack Chronicles</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/tags">Topics</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">All Topics</a></li><li><a class="dropdown__link" href="/tags/gcp">Google Cloud Platform</a></li><li><a class="dropdown__link" href="/tags/aws">AWS</a></li><li><a class="dropdown__link" href="/tags/azure">Azure</a></li><li><a class="dropdown__link" href="/tags/snowflake">Snowflake</a></li><li><a class="dropdown__link" href="/tags/okta">Okta</a></li><li><a class="dropdown__link" href="/tags/openapi">OpenAPI</a></li><li><a class="dropdown__link" href="/tags/spark">Spark</a></li><li><a class="dropdown__link" href="/tags/kafka">Kafka</a></li><li><a class="dropdown__link" href="/tags/ci-cd">CI/CD</a></li></ul></div><a class="navbar__item navbar__link" href="/archive">Archive</a><a href="https://github.com/stackql/fullstackchronicles.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/recurse-javascript-object-to-get-values-for-a-given-key-the-easy-way">Recurse JavaScript Object to Get Values for a Given Key the Easy Way</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/dataops-with-container-images-and-multi-stage-builds">DataOps with Container Images and Multi-Stage Builds</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/using-the-snowflake-sql-api-with-typescript">Using the Snowflake SQL API with TypeScript</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/split-a-large-swagger-openapi-specification-into-smaller-documents">Split a large Open API or Swagger Specification into smaller documents</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/stream-processing-with-spark-structured-streaming-kafka-and-snowflake-using-python">Stream Processing with Spark Structured Streaming, Kafka and Snowflake using Python</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/simple-cli-pkce-auth-using-okta">Simple CLI Application to Login to Okta using PKCE</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/cloudy-with-a-chance-of-big-data-has-moved">Cloudy with a Chance of Big Data has Moved</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/scaling-up-prefect-with-gitstorage">Scaling up Prefect with GitStorage</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/implementing-a-serverless-sftp-gateway-using-the-aws-transfer-family">Implementing a Serverless SFTP Gateway using the AWS Transfer Family</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/simple-sso-with-an-external-idp-using-active-directory-and-okta">Simple SSO with an external IdP using Active Directory and Okta</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/using-the-azure-cli-to-create-an-api-using-a-function-app-within-api-management">Using the Azure CLI to Create an API using a Function App within API Management</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2021-01-06T00:00:00.000Z" itemprop="datePublished">January 6, 2021</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://fullstackchronicles.io/images/api-management-function-app.png"><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="API Management Function App" src="data:image/png;base64,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" width="101" height="115" class="img_E7b_"></p><p>Function Apps, Logic Apps and App Services can be used to expose APIs within Azure API Management which is an easy way to deploy serverless microservices. You can see this capability in the Azure portal below within API Management:</p><p><a target="_blank" href="/assets/files/apimamanagement-add-fnapp-a479fd5e902fc785cebfdce4e32d60d8.png"><img loading="lazy" alt="Add a new API using a Function App as a back end" src="/assets/images/apimamanagement-add-fnapp-a479fd5e902fc785cebfdce4e32d60d8.png" width="1920" height="1040" class="img_E7b_"></a></p><p>Like most readers, I like to script everything, so I was initially frustrated when I couldn’t replicate this operation in the Azure cli, REST, PowerShell, or any of the other SDKs or IaC tools. Others shared my frustration as seen <a href="https://feedback.azure.com/forums/248703-api-management/suggestions/36832033-programmatically-import-azure-function-into-apim" target="_blank" rel="noopener noreferrer">here</a>.</p><p>I was nearly resigned to using click ops in the portal (arrrgh) before I worked out this workaround.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="the-solution">The Solution<a class="hash-link" href="#the-solution" title="Direct link to heading">​</a></h2><p>There is a bit more prep work required to automate this process, but it is well worth it.</p><ol><li>Create an OpenApi (or Swagger spec or WADL) specification document, as seen below (use the absolute URL for your Function App in the <code>url</code> parameter):</li></ol><iframe width="100%" frameborder="0" id="gist-077e8f313e6f44393df71057c8af7850"></iframe><ol start="2"><li>Use the <code>az apim api import</code> function (not the <code>az apim api create</code> function), as shown here:</li></ol><iframe width="100%" frameborder="0" id="gist-1f5eec542bd5ec01dbb9a06472e8e59b"></iframe><ol start="3"><li>Associate the API with a product (which is how you can rate limit APIs)</li></ol><iframe width="100%" frameborder="0" id="gist-4ad9c81b97ee97fb2cb6f794c2ae820f"></iframe><p>That’s it! You can now access your function via the API gateway using the gateway url or via the developer portal as seen below:</p><p><a target="_blank" href="/assets/files/apimamanagement-test-api-52e41024ea9942790e112d030d65965f.png"><img loading="lazy" alt="Function App API in API Management in the Azure Portal" src="/assets/images/apimamanagement-test-api-52e41024ea9942790e112d030d65965f.png" width="1920" height="1040" class="img_E7b_"></a></p><p><a target="_blank" href="/assets/files/apimamanagement-dev-portal-5cb59bd69af224f871a17852fcffb30e.png"><img loading="lazy" alt="Function App API in the Dev Portal" src="/assets/images/apimamanagement-dev-portal-5cb59bd69af224f871a17852fcffb30e.png" width="1920" height="1040" class="img_E7b_"></a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/api-management">api-management</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/apis">apis</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/azure">azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/function-app">function-app</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microservices">microservices</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microsoft-azure">microsoft-azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/serverless">serverless</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/great-expectations-for-your-data">Great Expectations (for your data...)</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-11-27T00:00:00.000Z" itemprop="datePublished">November 27, 2020</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/tomklimovskigamma" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="http://2.gravatar.com/avatar/58faa98ad68138dd1997f828f00a882e?s=80" alt="Tom Klimovski"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tomklimovskigamma" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Tom Klimovski</span></a></div><small class="avatar__subtitle" itemprop="description">Senior Cloud Engineer</small></div></div></div></div></header><meta itemprop="image" content="https://fullstackchronicles.io/images/great-expectations.png"><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Great Expectations" src="/assets/images/great-expectations-f9bde762a58323b62e2c19c514c74ba8.png" width="165" height="184" class="img_E7b_"></p><p>This article provides an introduction to the Great Expectations Python library for data quality management (<a href="https://github.com/great-expectations/great_expectations" target="_blank" rel="noopener noreferrer">https://github.com/great-expectations/great<!-- -->_<!-- -->expectations</a>).</p><p>So what are expectations when it comes to data (and data quality)...</p><p>An expectation is a falsifiable, verifiable statement about data. Expectations provide a language to talk about data characteristics and data quality - humans to humans, humans to machines and machines to machines.</p><p>The <strong>great expectations</strong> project includes predefined, codified expectations such as:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_to_exist </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_table_row_count_to_be_between </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_values_to_be_unique </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_values_to_not_be_null </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_values_to_be_between </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_values_to_match_regex </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_mean_to_be_between </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect_column_kl_divergence_to_be_less_than</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>… and many more</p><p>Expectations are both data tests and docs! Expectations can be presented in a machine-friendly JSON, for example:</p><iframe width="100%" frameborder="0" id="gist-317fa68cc27e4e364ab238a93f6ed361"></iframe><p>Great Expectations provides validation results of defined expectations, which can dramatically shorten your development cycle.</p><p>[<img loading="lazy" alt="validation results in great expectations" src="/assets/images/validation_failed_unexpected_values-a2b73285ee54843380f035441f0c49e0.gif" width="1445" height="851" class="img_E7b_">](validation results in great expectations)</p><p>Nearly 50 built in expectations allow you to express how you understand your data, and you can add custom expectations if you need a new one. A machine can test if a dataset conforms to the expectation.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ok-enough-talk-lets-go">OK, enough talk, let&#x27;s go!<a class="hash-link" href="#ok-enough-talk-lets-go" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">pyenv virtualenv </span><span class="token number" style="color:#36acaa">3.8</span><span class="token plain">.2 ge38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> great-expectations</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>tried with Python 3.7.2, but had issues with library <code>lgzm</code> on my local machine</p><p>once installed, run the following in the python repl shell:</p><iframe width="100%" frameborder="0" id="gist-78211408899d5d0d4b1a088d039fe1d3"></iframe><p>showing the data in the dataframe should give you the following:</p><iframe width="100%" frameborder="0" id="gist-fbdeda83bfe9af7ceb33a36a3f4a29e0"></iframe><p>as can be seen, a collection of random integers in each column for our initial testing. Let&#x27;s pipe this data in to great-expectations...</p><iframe width="100%" frameborder="0" id="gist-0bf00ff1bfad316f83f1b458aa2ad01b"></iframe><p>yields the following output...</p><iframe width="100%" frameborder="0" id="gist-83264e645d220ebb0f0a529a2a139be9"></iframe><p>this shows that there are 0 unexpected items in the data we are testing. Great!</p><p>Now let&#x27;s have a look at a negative test. Since we&#x27;ve picked the values at random, there are bound to be duplicates. Let&#x27;s test that:</p><iframe width="100%" frameborder="0" id="gist-0a75fe9700677d0329d96da44c54dca5"></iframe><p>yields...</p><iframe width="100%" frameborder="0" id="gist-0c714a928064124ec15c9733d9e5ff29"></iframe><p>The JSON schema has metadata information about the result, of note is the result section which is specific to our query, and shows the percentage that failed the expectation.</p><p>Let&#x27;s progress to something more real-world, namely creating exceptions that are run on databases. Armed with our basic understanding of great-expectations, let&#x27;s...</p><ul><li>set up a postgres database</li><li>initiate a new Data Context within great-expectations</li><li>write test-cases for the data</li><li>group those test-cases and</li><li>run it</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="setting-up-a-database">Setting up a Database<a class="hash-link" href="#setting-up-a-database" title="Direct link to heading">​</a></h2><iframe width="100%" frameborder="0" id="gist-30dc4a230656f36c4c9b7b208b792329"></iframe><p>if you don&#x27;t have it installed,</p><iframe width="100%" frameborder="0" id="gist-b127a57c499e63c003ac6c8bb4408768"></iframe><p>wait 15 minutes for download the internet. Verify postgres running with <code>docker ps</code>, then connect with</p><iframe width="100%" frameborder="0" id="gist-d33c81448fcfddb608f79a69a75202a1"></iframe><p>Create some data</p><iframe width="100%" frameborder="0" id="gist-13069c3111039ac60281f291dc1e6bd8"></iframe><p>Take data for a spin</p><iframe width="100%" frameborder="0" id="gist-f62857c6dbaaaf1d784aa94c5914c9f5"></iframe><p>should yield</p><iframe width="100%" frameborder="0" id="gist-52e11ea7319f8344674999ec1b36ab0e"></iframe><p>Now time for <code>great-expectations</code></p><p>Great Expectations relies on the library <code>sqlalchemy</code> and <code>psycopg2</code> to connect to your data.</p><iframe width="100%" frameborder="0" id="gist-6bd28c03b4013f4301b1af2c74dcd947"></iframe><p>once done, let&#x27;s set up <code>great-expectations</code></p><iframe width="100%" frameborder="0" id="gist-4210011daa1fb3c738875f917ebafbf3"></iframe><p>should look like below:</p><iframe width="100%" frameborder="0" id="gist-1f1a698cf6a6785598db1133212f30fe"></iframe><p>let&#x27;s set up a few other goodies while we&#x27;re here</p><iframe width="100%" frameborder="0" id="gist-51f684d6db8149950f28cc32afa2f461"></iframe><p><strong>Congratulations! Great Expectations is now set up</strong></p><p>You should see a file structure as follows:</p><p><a target="_blank" href="/assets/files/ge_tree_structure-f4723cba7eb3bfd4504919b2f45f2b8f.png"><img loading="lazy" alt="great expectations tree structure" src="/assets/images/ge_tree_structure-f4723cba7eb3bfd4504919b2f45f2b8f.png" width="643" height="379" class="img_E7b_"></a></p><p>If you didn&#x27;t generate a suite during the set up based on <code>app.order</code>, you can do so now with</p><p><code>great_expectations suite new</code></p><p>when created, looking at <code>great_expectations/expectations/app/order/warning.json</code> should yield the following:</p><iframe width="100%" frameborder="0" id="gist-24d105be1cacacbd89b9e4cbac6f4d21"></iframe><p>as noted in the content section, this expectation config is created by the tool by looking at 1000 rows of the data. We also have access to the data-doc site which we can open in the browser at <code>great_expectations/uncommitted/data_docs/local_site/index.html</code></p><p><a target="_blank" href="/assets/files/index-page-b171b0a598aad39f638405c0a644224a.png"><img loading="lazy" alt="great expectations index page" src="/assets/images/index-page-b171b0a598aad39f638405c0a644224a.png" width="3548" height="898" class="img_E7b_"></a></p><p>Clicking on <code>app.order.warning</code>, you&#x27;ll see the sample expectation shown in the UI</p><p><a target="_blank" href="/assets/files/ge-app.order-screen-627a827e75a8c9079908c3d78ff40ff4.png"><img loading="lazy" alt="great expectations app order screen" src="/assets/images/ge-app.order-screen-627a827e75a8c9079908c3d78ff40ff4.png" width="3394" height="1842" class="img_E7b_"></a></p><p>Now, let&#x27;s create our own <code>expectation</code> file and take it for a spin. We&#x27;ll call this one <code>error</code>.</p><p><a target="_blank" href="/assets/files/ge_suite_new-ce1fbc3a1ce68a91829faa2da0a12a9b.png"><img loading="lazy" alt="great expectations new suite" src="/assets/images/ge_suite_new-ce1fbc3a1ce68a91829faa2da0a12a9b.png" width="900" height="258" class="img_E7b_"></a></p><p>This should also start a <code>jupyter notebook</code>. If for some reason you need to start it back up again, you can do so with</p><iframe width="100%" frameborder="0" id="gist-b4c9fed39b89d939127e4b381c49f274"></iframe><p>Go ahead and hit <code>run</code> on your first cell.</p><p><a target="_blank" href="/assets/files/jupyter-edit-suite-3f4a6d5cb8e7078a22430b54b9ddce83.png"><img loading="lazy" alt="Editing a suite with Jupyter" src="/assets/images/jupyter-edit-suite-3f4a6d5cb8e7078a22430b54b9ddce83.png" width="1141" height="811" class="img_E7b_"></a></p><p>Let&#x27;s keep it simple and test the <code>customer_order_id</code> column is in a set with the values below:</p><iframe width="100%" frameborder="0" id="gist-fea43e4e566795213fc1c5bbcda317ad"></iframe><p>using the following expectations function in your Table Expectation(s). You may need to click the <code>+</code> sign in the toolbar to insert a new cell, as below:</p><iframe width="100%" frameborder="0" id="gist-38be05ccb27c21da2b4213d6a63afd83"></iframe><p><a target="_blank" href="/assets/files/add-table-expectation-6512aa26bc021be3ba9b53841686cc42.png"><img loading="lazy" alt="Adding table expectation" src="/assets/images/add-table-expectation-6512aa26bc021be3ba9b53841686cc42.png" width="1173" height="527" class="img_E7b_"></a></p><p>As we can see, appropriate json output that describes the output of our expectation. Go ahead and run the final cell, which will save our work and open a newly minted data documentation UI page, where you&#x27;ll see the expectations you defined in human readable form.</p><p><a target="_blank" href="/assets/files/saved-suite-c6cd9523f14fe9505ebb099b946f6b11.png"><img loading="lazy" alt="Saved suite" src="/assets/images/saved-suite-c6cd9523f14fe9505ebb099b946f6b11.png" width="1836" height="679" class="img_E7b_"></a></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="running-the-test-cases">Running the test cases<a class="hash-link" href="#running-the-test-cases" title="Direct link to heading">​</a></h2><p>In Great Expectations, running a set of expectations (test cases) is called a <code>checkpoint</code>. Let&#x27;s create a new checkpoint called <code>first_checkpoint</code> for our <code>app.order.error</code> expectation as shown below:</p><iframe width="100%" frameborder="0" id="gist-322483724633e8a4513c5d6ae67298ae"></iframe><p>Let&#x27;s take a look at our checkpoint definition.</p><iframe width="100%" frameborder="0" id="gist-08594ad6420d46fe60be41d9d949605c"></iframe><iframe width="100%" frameborder="0" id="gist-9cdd4da31f9fdef1246092fa5b65e90c"></iframe><p>Above you can see the <code>validation_operator_name</code> which points to a definition in <code>great_expectations.yml</code>, and the <code>batches</code> where we defined the data source and what expectations to run against.</p><p>Let&#x27;s have a look at <code>great_expectations.yml</code>. We can see the <code>action_list_operator</code> defined and all the actions it contains:</p><p><a target="_blank" href="/assets/files/ge_action_list_operator-6915235227abad5c1de8f90c65c039aa.png"><img loading="lazy" alt="List operators" src="/assets/images/ge_action_list_operator-6915235227abad5c1de8f90c65c039aa.png" width="948" height="317" class="img_E7b_"></a></p><p>Let&#x27;s run our checkpoint using</p><iframe width="100%" frameborder="0" id="gist-050501513ee0f5fa13ab522ea7b9242e"></iframe><p><a target="_blank" href="/assets/files/validate-checkpoint-48062ec26f50cc84657b7accf4fe387d.png"><img loading="lazy" alt="Validate checkpoint" src="/assets/images/validate-checkpoint-48062ec26f50cc84657b7accf4fe387d.png" width="887" height="117" class="img_E7b_"></a></p><p>Okay cool, we&#x27;ve set up an expectation, a checkpoint and shown a successful status! But what does a failure look like? We can introduce a failure by logging in to postgres and inserting a <code>customer_11</code> that we&#x27;ll know will fail, as we&#x27;ve specific our expectation that <code>customer_id</code> should only have two values..</p><iframe width="100%" frameborder="0" id="gist-5bce4ba20ab8bfae5910db5cd6cc66f4"></iframe><p>Here are the commands to make that happen, as well as the command to re-run our checkpoint:</p><iframe width="100%" frameborder="0" id="gist-4ad6f1753d65a4f099467bd9fd760067"></iframe><iframe width="100%" frameborder="0" id="gist-fa94ded27b212e099177bee9d6a2cd36"></iframe><p>Run checkpoint again, this time it should fail</p><iframe width="100%" frameborder="0" id="gist-12fb3e62a5bbcd205ee84ff7445e2657"></iframe><p><a target="_blank" href="/assets/files/failed-checkpoint-9b060fe10a72c97ae28a0e2ea11ff76e.png"><img loading="lazy" alt="Failed checkpoint" src="/assets/images/failed-checkpoint-9b060fe10a72c97ae28a0e2ea11ff76e.png" width="883" height="123" class="img_E7b_"></a></p><p><strong>As expected, it failed.</strong></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="supported-databases">Supported Databases<a class="hash-link" href="#supported-databases" title="Direct link to heading">​</a></h2><p>In it&#x27;s current implementation <code>version 0.12.9</code>, the supported databases our of the box are:</p><iframe width="100%" frameborder="0" id="gist-4816fb9a621d2d660f746b62ab54ba59"></iframe><p>It&#x27;s great to be BigQuery supported out of the box, but what about Google Spanner and Google BigTable? Short-answer; currently not supported. See tickets <a href="https://github.com/googleapis/google-cloud-python/issues/3022" target="_blank" rel="noopener noreferrer">https://github.com/googleapis/google-cloud-python/issues/3022</a>.</p><p>With respect to BigTable, it may not be possible as SQLAlchemy can only manage SQL-based RDBSM-type systems, while BigTable (and HBase) are NoSQL non-relational systems.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="scheduling">Scheduling<a class="hash-link" href="#scheduling" title="Direct link to heading">​</a></h2><p>Now that we have seen how to run tests on our data, we can run our checkpoints from bash or a python script(generated using great_expectations checkpoint script first_checkpoint). This lends itself to easy integration with scheduling tools like airflow, cron, prefect, etc.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="production-deployment">Production deployment<a class="hash-link" href="#production-deployment" title="Direct link to heading">​</a></h2><p>When deploying in production, you can store any sensitive information(credentials, validation results, etc) which are part of the uncommitted folder in cloud storage systems or databases or data stores depending on your infratructure setup. Great Expectations has a lot of options</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="when-not-to-use-a-data-quality-framework">When not to use a data quality framework<a class="hash-link" href="#when-not-to-use-a-data-quality-framework" title="Direct link to heading">​</a></h2><p>This tool is great and provides a lot of advanced data quality validation functions, but it adds another layer of complexity to your infrastructure that you will have to maintain and trouble shoot in case of errors. It would be wise to use it only when needed.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="in-general">In general<a class="hash-link" href="#in-general" title="Direct link to heading">​</a></h2><p>Do not use a data quality framework, if simple SQL based tests at post load time works for your use case. Do not use a data quality framework, if you only have a few (usually &lt; 5) simple data pipelines.</p><p>Do use it when you have data that needs to be tested in an automated and a repeatable fashion. As shown in this article, Great Expectations has a number of options that can be toggled to suit your particular use-case.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>Great Expectations shows a lot of promise, and it&#x27;s an active project so expect to see features roll out frequently. It&#x27;s been quite easy to use, but I&#x27;d like to see all it&#x27;s features work in a locked-down enterprise environment.</p><p>Tom Klimovski<br>
<!-- -->Principal Consultant, Gamma Data<br>
<a href="mailto:tom.klimovski@gammadata.io" target="_blank" rel="noopener noreferrer">tom.klimovski@gammadata.io</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/data">data</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/data-quality">data-quality</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/data-quality-management">data-quality-management</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/multi-cloud-diagramming-with-plantuml">Multi Cloud Diagramming with PlantUML</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-10-26T00:00:00.000Z" itemprop="datePublished">October 26, 2020</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://fullstackchronicles.io/images/multicloud.png"><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Mulitcloud Diagramming" src="/assets/images/multicloud-a32d180e26bba79580f5d8936b1b63dc.png" width="152" height="122" class="img_E7b_"></p><p>Following on from the recent post <a href="https://cloudywithachanceofbigdata.com/gcp-templates-for-c4-diagrams-using-plantuml/" target="_blank" rel="noopener noreferrer">GCP Templates for C4 Diagrams using PlantUML</a>, cloud architects are often challenged with producing diagrams for architectures spanning multiple cloud providers, particularly as you elevate to enterprise level diagrams.</p><p>In this post, with the magic of <code>!includeurl</code> we have brought PlantUML template libraries together for AWS, Azure and GCP icon sets, allowing us to produce multi cloud C4 diagrams using PlantUML like this one:</p><p><a target="_blank" href="/assets/files/Example-Multi-Cloud-PlantUML-C4-Diagram-8695466addda79c4432fca63824ab2eb.png"><img loading="lazy" alt="Multi Cloud Architecture Diagram using PlantUML" src="/assets/images/Example-Multi-Cloud-PlantUML-C4-Diagram-8695466addda79c4432fca63824ab2eb.png" width="1224" height="760" class="img_E7b_"></a></p><p>Creating a multi cloud diagram is simple, start by adding the following <code>include</code> statements after the <code>@startuml</code> label in a new PlantUML C4 diagram:</p><iframe width="100%" frameborder="0" id="gist-5319b6b041f8b8f54c922a9a5b9b6e7c"></iframe><p>Then add references to the required services from different providers…</p><iframe width="100%" frameborder="0" id="gist-6ed55cd1b4e3b2e7027f8236af4aa112"></iframe><p>Then include the predefined resources from your different cloud providers in your diagram as shown here (describing a client server application over a cloud to cloud VPN between Azure and GCP)...</p><iframe width="100%" frameborder="0" id="gist-600aecff7094d7843771770b7048cb2c"></iframe><p>Happy multi-cloud diagramming!</p><blockquote><p>Full source code is available at:</p><p><a href="https://github.com/gamma-data/plantuml-multi-cloud-diagrams" target="_blank" rel="noopener noreferrer">https://github.com/gamma-data/plantuml-multi-cloud-diagrams</a></p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/amazonwebservices">amazonwebservices</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/aws">aws</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/azure">azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/c-4-model">c4model</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/diagramming">diagramming</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/gcp">gcp</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/google-cloud-platform">google-cloud-platform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/googlecloudplatform">googlecloudplatform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microsoft-azure">microsoft-azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/multi-cloud">multi-cloud</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/plantuml">plantuml</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/software-architecture">software-architecture</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/cloud-bigtable-primer-part-ii-row-key-selection-and-schema-design">Cloud Bigtable Primer Part II – Row Key Selection and Schema Design</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-09-13T00:00:00.000Z" itemprop="datePublished">September 13, 2020</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://fullstackchronicles.io/images/cbt-featured-image.png"><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Cloud BigTable" src="/assets/images/cbt-featured-image-24d6cccb361d66b89ca92944ff955de9.png" width="151" height="121" class="img_E7b_"></p><p>This is a follow up to the original Cloud Bigtable primer where we discussed the basics of Cloud Bigtable:</p><p><a href="https://cloudywithachanceofbigdata.com/cloud-bigtable-primer-part-i/" target="_blank" rel="noopener noreferrer"><strong>Cloud Bigtable Primer - Part I</strong></a></p><p>In this article we will cover schema design and row key selection in Bigtable – arguably the most critical design decision to make when employing Bigtable in a cloud data architecture.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="quick-review">Quick Review<a class="hash-link" href="#quick-review" title="Direct link to heading">​</a></h2><p>Recall from the previous post where the Bigtable data model was introduced that tables in Bigtable are comprised of rows and columns - much like a table in any other RDBMS. Every row is uniquely identified by a rowkey – again akin to a primary key in a table in an RDBMS. But this is where the similarities end.</p><p>Unlike a table in an RDBMS, columns only ever exist when they are inserted, and <code>NULLs</code> are not stored. See the illustration below:</p><p><a target="_blank" href="/assets/files/bigtable-data-model-0e76eb10501530b624d8be2abe3a46df.png"><img loading="lazy" src="/assets/images/bigtable-data-model-0e76eb10501530b624d8be2abe3a46df.png" width="1024" height="297" class="img_E7b_"></a></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="row-key-selection">Row Key Selection<a class="hash-link" href="#row-key-selection" title="Direct link to heading">​</a></h2><p>Data in Bigtable is distributed by row keys. Row keys are physically stored in tablets in lexographic order. Recall that row keys are your ONLY indexes to data in Bigtable.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="selection-considerations">Selection Considerations<a class="hash-link" href="#selection-considerations" title="Direct link to heading">​</a></h3><p>As row keys are your only indexes to retrieve or update rows in Bigtable, row key design must take the access patterns for the data to be stored and served via Bigtable into consideration, specifically the following must be considered when designing a Bigtable application:</p><ul><li>Search patterns (returning data for a specific entity)</li><li>Scan patterns (returning batches of data)</li></ul><p>Queries that use the row key, a row prefix, or a row range are the most efficient. Queries that do not include a row key will typically scan GB or TB of data and would not be suitable for operational use cases.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="row-key-performance">Row Key Performance<a class="hash-link" href="#row-key-performance" title="Direct link to heading">​</a></h3><p>Row key performance will be biased towards your specific access patterns and application functional requirements. For example if you are performing sequential reads or scan operations then sequential keys will perform the best, however their write performance will not be optimal. Conversely, random keys (such as a <code>uuid</code>) will perform best for writes but poor for scan or sequential read operations.</p><p>Adding salts to keys (or additional data), similar to the use of salts in cryptography as well as promoting other field keys to be part of a composite row key can help achieve a “Goldilocks” scenario for both reads and writes, see the diagram below:</p><p><a target="_blank" href="/assets/files/keys-418e33748532e78f24865d6aad4c8ac4.png"><img loading="lazy" src="/assets/images/keys-418e33748532e78f24865d6aad4c8ac4.png" width="684" height="551" class="img_E7b_"></a></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="using-reverse-timestamps">Using Reverse Timestamps<a class="hash-link" href="#using-reverse-timestamps" title="Direct link to heading">​</a></h3><p>Use reverse timestamps when your most common query is for the latest values. Typically you would append the reverse timestamp to the key, this will ensure that the same related records are grouped together, for instance if you are storing events for a customer using the customer id along with an appended reverse timestamp (for example <code>&lt;customer_id&gt;#&lt;reverse_ts&gt;</code>) would allow you to quickly serve the latest events for a customer in descending order as within each group (<code>customer_id</code>), rows will be sorted so most recent insert will be located at the top.<br>
<!-- -->A reverse timestamp can be generalised as:</p><p><code>Long.MAX_VALUE - System.currentTimeMillis()</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="schema-design-tips">Schema Design Tips<a class="hash-link" href="#schema-design-tips" title="Direct link to heading">​</a></h3><p>Some general tips for good schema design using Bigtable are summarised below:</p><ul><li>Group related data for more efficient reads using column families</li><li>Distribute data evenly for more efficient writes</li><li>Place identical values in the adjoining rows for more efficient compression using row keys</li></ul><p>Following these tips will give you the best possible performance using Bigtable.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="use-the-key-visualizer-to-profile-performance">Use the Key Visualizer to profile performance<a class="hash-link" href="#use-the-key-visualizer-to-profile-performance" title="Direct link to heading">​</a></h3><p>Google provides a neat tool to visualize your row key distribution in Cloud Bigtable. You need to have at least 30 GB of data in your table to enable this feature.</p><p>The Key Visualizer is shown here:</p><p><a target="_blank" href="/assets/files/image-d2e2037eaf05cfcfebc613b7821d624d.png"><img loading="lazy" alt="Bigtable Key Visualizer" src="/assets/images/image-d2e2037eaf05cfcfebc613b7821d624d.png" width="733" height="403" class="img_E7b_"></a></p><p>The Key Visualizer will help you find and prevent hotspots, find rows with too much data and show if your key schema is balanced.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h3><p>Bigtable is one of the original and best (massively) distributed NoSQL platforms available. Schema and moreover row key design play a massive part in ensuring low latency and query performance. Go forth and conquer with Cloud Bigtable!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/bigtable">bigtable</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cloud-bigtable">cloud-bigtable</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/gcp">gcp</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/google-cloud-platform">google-cloud-platform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/googlecloudplatform">googlecloudplatform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/nosql">nosql</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/gcp-templates-for-c4-diagrams-using-plantuml">GCP Templates for C4 Diagrams using PlantUML</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-08-14T00:00:00.000Z" itemprop="datePublished">August 14, 2020</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://fullstackchronicles.io/images/gcp-c4.png"><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="GCP C4 Diagramming" src="/assets/images/gcp-c4-2dfa642388856ec47d841196e16f1e0f.png" width="150" height="120" class="img_E7b_"></p><p>I am a believer in the mantra of <em><strong>“Everything-as-Code”</strong></em>, this includes diagrams and other architectural artefacts. Enter PlantUML…</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="plantuml">PlantUML<a class="hash-link" href="#plantuml" title="Direct link to heading">​</a></h2><p><a href="https://plantuml.com/" target="_blank" rel="noopener noreferrer">PlantUML</a> is an open-source tool which allows users to create UML diagrams from an intuitive DSL (Domain Specific Language). PlantUML is built on top of Graphviz and enables software architects and designers to use code to create Sequence Diagrams, Use Case Diagrams, Class Diagrams, State and Activity Diagrams and much more.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="c4-diagrams">C4 Diagrams<a class="hash-link" href="#c4-diagrams" title="Direct link to heading">​</a></h2><p>PlantUML can be extended to support the <a href="https://c4model.com/" target="_blank" rel="noopener noreferrer">C4 model</a> for visualising software architecture. Which describes software in different layers including Context, Container, Component and Code diagrams.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="gcp-architecture-diagramming-using-c4">GCP Architecture Diagramming using C4<a class="hash-link" href="#gcp-architecture-diagramming-using-c4" title="Direct link to heading">​</a></h2><p>PlantUML and C4 can be used to produce cloud architectures, there are official libraries available through PlantUML for Azure and AWS service icons, however these do not exist for GCP yet. There are several open source libraries available, however I have made an attempt to simplify the implementation.</p><p>The code below can be used to generate a C4 diagram describing a GCP architecture including official GCP service icons:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@startuml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!define GCPPuml https://raw.githubusercontent.com/gamma-data/GCP-C4-PlantUML/master/templates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/C4\_Context.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/C4\_Component.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/C4\_Container.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/GCPC4Integration.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/GCPCommon.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Networking/CloudDNS.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Networking/CloudLoadBalancing.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Compute/ComputeEngine.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Storage/CloudStorage.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Databases/CloudSQL.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title Sample C4 Diagram with GCP Icons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Person(publisher, &quot;Publisher&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System\_Ext(device, &quot;User&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Boundary(gcp,&quot;gcp-project&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudDNS(dns, &quot;Managed Zone&quot;, &quot;Cloud DNS&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudLoadBalancing(lb, &quot;L7 Load Balancer&quot;, &quot;Cloud Load Balancing&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CloudStorage(bucket, &quot;Static Content Bucket&quot;, &quot;Cloud Storage&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Boundary(region, &quot;gcp-region&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boundary(zonea, &quot;zone a&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComputeEngine(gcea, &quot;Content Server&quot;, &quot;Compute Engine&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CloudSQL(csqla, &quot;Dynamic Content&quot;, &quot;Cloud SQL&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Boundary(zoneb, &quot;zone b&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComputeEngine(gceb, &quot;Content Server&quot;, &quot;Compute Engine&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CloudSQL(csqlb, &quot;Dynamic Content\\n(Read Replica)&quot;, &quot;Cloud SQL&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(device, dns, &quot;resolves name&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(device, lb, &quot;makes request&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(lb, gcea, &quot;routes request&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(lb, gceb, &quot;routes request&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(gcea, bucket, &quot;get static content&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(gceb, bucket, &quot;get static content&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(gcea, csqla, &quot;get dynamic content&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(gceb, csqla, &quot;get dynamic content&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(csqla, csqlb, &quot;replication&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rel(publisher,bucket,&quot;publish static content&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@enduml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>The preceding code generates the diagram below:</p><p><a target="_blank" href="/assets/files/Sample-C4-Diagram-with-GCP-Icons-291a0d7d898c0130b13e980e6752ec79.png"><img loading="lazy" src="/assets/images/Sample-C4-Diagram-with-GCP-Icons-291a0d7d898c0130b13e980e6752ec79.png" width="662" height="1437" class="img_E7b_"></a></p><p>Additional services can be added and used in your diagrams by adding them to your includes, such as:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/DataAnalytics/BigQuery.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/DataAnalytics/CloudDataflow.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/AIandMachineLearning/AIHub.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/AIandMachineLearning/CloudAutoML.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/DeveloperTools/CloudBuild.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/HybridandMultiCloud/Stackdriver.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/InternetofThings/CloudIoTCore.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Migration/TransferAppliance.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!includeurl GCPPuml/Security/CloudIAM.puml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; and more…</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><blockquote><p>The complete template library is available at:</p><p><a href="https://github.com/gamma-data/GCP-C4-PlantUML" target="_blank" rel="noopener noreferrer">https://github.com/gamma-data/GCP-C4-PlantUML</a></p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/c-4-model">c4model</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/diagramming">diagramming</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/gcp">gcp</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/google-cloud-platform">google-cloud-platform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/googlecloudplatform">googlecloudplatform</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/plantuml">plantuml</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/software-architecture">software-architecture</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/5"><div class="pagination-nav__label">Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/7"><div class="pagination-nav__label">Older Entries</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a href="https://stackql.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">StackQL<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gammadata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gamma Data<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.windrate.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">WindRate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/stackql/fullstackchronicles.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.15fd567d.js"></script>
<script src="/assets/js/main.6d1825e7.js"></script>
</body>
</html>