<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Cloudy with a chance of Big Data Blog Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Cloudy with a chance of Big Data Blog Feed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Cloudy with a chance of Big Data Blog Feed JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4N6KSJ2G0P"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4N6KSJ2G0P",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Cloudy with a chance of Big Data" href="/opensearch.xml"><title data-react-helmet="true">JSON Wrangling with Go | Cloudy with a chance of Big Data</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://cloudywithachanceofbigdata.com/json-wrangling-with-go"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="JSON Wrangling with Go | Cloudy with a chance of Big Data"><meta data-react-helmet="true" name="description" content="Golang is a fantastic language but at first glance it is a bit clumsy when it comes to JSON in contrast to other languages such as Python or Javascript. Having said that once you master the concepts involved with JSON wrangling using Go it is equally as functional ‚Äì with added type safety and performance."><meta data-react-helmet="true" property="og:description" content="Golang is a fantastic language but at first glance it is a bit clumsy when it comes to JSON in contrast to other languages such as Python or Javascript. Having said that once you master the concepts involved with JSON wrangling using Go it is equally as functional ‚Äì with added type safety and performance."><meta data-react-helmet="true" name="keywords" content="golang,json"><meta data-react-helmet="true" property="og:image" content="https://cloudywithachanceofbigdata.com/images/json-go.png"><meta data-react-helmet="true" name="twitter:image" content="https://cloudywithachanceofbigdata.com/images/json-go.png"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2020-04-22T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://www.linkedin.com/in/jeffreyaven/"><meta data-react-helmet="true" property="article:tag" content="golang,json"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cloudywithachanceofbigdata.com/json-wrangling-with-go"><link data-react-helmet="true" rel="alternate" href="https://cloudywithachanceofbigdata.com/json-wrangling-with-go" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cloudywithachanceofbigdata.com/json-wrangling-with-go" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.fe05d8b3.css">
<link rel="preload" href="/assets/js/runtime~main.711097e0.js" as="script">
<link rel="preload" href="/assets/js/main.fe6a2a08.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#A9BCD0;color:#1A4E82" role="banner"><div class="announcementBarContent_KsVm"><b>If you find our content useful, give it a ‚≠êÔ∏è on <a target="_blank" rel="noopener noreferrer" href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io">GitHub</a>, if you want to contribute and become an author, submit a PR</b></div></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Cloudy with a chance of Big Data</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/tags">Topics</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">All Topics</a></li><li><a class="dropdown__link" href="/tags/gcp">Google Cloud Platform</a></li><li><a class="dropdown__link" href="/tags/aws">AWS</a></li><li><a class="dropdown__link" href="/tags/azure">Azure</a></li><li><a class="dropdown__link" href="/tags/ci-cd">CI/CD</a></li></ul></div><a class="navbar__item navbar__link" href="/archive">Archive</a><a href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">üåú</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">üåû</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/converting-to-local-time-in-aws-lambda-using-nodejs">Converting to local time in AWS Lambda using Node.js</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/automating-snowflake-role-based-storage-integration-for-aws">Automating Snowflake Role Based Storage Integration for AWS</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/simplifying-large-cloudformation-templates-using-jsonnet">Simplifying Large CloudFormation Templates using Jsonnet</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/aws-deployments-with-cloudformation-and-gitlab-ci">Simplified AWS Deployments with CloudFormation and GitLab CI</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/from-wordpress-to-jamstack">From Wordpress to Jamstack</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/using-jsonnet-to-configure-multiple-environments">Using Jsonnet to Configure Multiple Environments</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/use-bigquery-to-trigger-cloud-run">Use BigQuery to trigger Cloud Run</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/azure-static-web-app-review">Azure Static Web App Review</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/introducing-the-metadata-hub-mdh">Introducing the Metadata Hub (MDH)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/masking-private-keys-in-ci-cd-pipelines-in-gitlab">Masking Private Keys in CI/CD Pipelines in GitLab</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">JSON Wrangling with Go</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-04-22T00:00:00.000Z" itemprop="datePublished">April 22, 2020</time> ¬∑ <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://s.gravatar.com/avatar/f96573d092470c74be233e1dded5376f?s=80" alt="Jeffrey Aven"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/jeffreyaven/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey Aven</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><meta itemprop="image" content="https://cloudywithachanceofbigdata.com/images/json-go.png"><div id="post-content" class="markdown" itemprop="articleBody"><p>Golang is a fantastic language but at first glance it is a bit clumsy when it comes to JSON in contrast to other languages such as Python or Javascript. Having said that once you master the concepts involved with JSON wrangling using Go it is equally as functional ‚Äì with added type safety and performance.</p><p>In this article we will build a program in Golang to parse a JSON file containing a collection held in a named key ‚Äì without knowing the structure of this object, we will expose the schema for the object including data types and recurse the object for its values.</p><p>This example uses a great Go package called <code>tablewriter</code> to render the output of these operations using a table style result set.</p><p>The program has <code>describe</code> and <code>select</code> verbs as operation types; describe shows the column names in the collection and their respective data types, select prints the keys and values as a tabular result set with column headers for the keys and rows containing their corresponding values.</p><p>Starting with this:</p><iframe width="100%" frameborder="0" id="gist-cceeb5b667ccfe8a9e20437d3f1dde42"></iframe><p>We will end up with this when performing a <code>describe</code> operation:</p><iframe width="100%" frameborder="0" id="gist-fbd04c220a70d439df3a14d4a4f48a3e"></iframe><p>And this when performing a <code>select</code> operation:</p><iframe width="100%" frameborder="0" id="gist-0b795b13b160cfbcd6796243c0fbb238"></iframe><p>Now let‚Äôs talk about how we got there‚Ä¶</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="the-json-package">The JSON package<a class="hash-link" href="#the-json-package" title="Direct link to heading">‚Äã</a></h2><p>Support for JSON in Go is provided using the <code>encoding/json</code> package, this needs to be imported in your program of course‚Ä¶ You will also need to import the <code>reflect</code> package ‚Äì more on this later. <code>io/ioutil</code> is required to read the data from a file input, there are other packages included in the program that are removed for brevity:</p><iframe width="100%" frameborder="0" id="gist-def7e02eac07ded8b80ff807cf023989"></iframe><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="reading-the-data">Reading the data‚Ä¶<a class="hash-link" href="#reading-the-data" title="Direct link to heading">‚Äã</a></h2><p>We will read the data from the JSON file into a variable called <code>body</code>, note that we are not attempting to deserialize the data at this point. This is also a good opportunity to handle any runtime or IO errors that occur here as well.</p><iframe width="100%" frameborder="0" id="gist-74a2c2c839a30ed8cc66d83d3ddde3b4"></iframe><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="the-interface">The interface‚Ä¶<a class="hash-link" href="#the-interface" title="Direct link to heading">‚Äã</a></h2><p>We will declare an empty interface called <code>data</code> which will be used to decode the json object (of which the structure is not known), we will also create an abstract interface called <code>colldata</code> to hold the contents of the collection contained inside the JSON object that we are specifically looking for:</p><iframe width="100%" frameborder="0" id="gist-32555f65af4be1fc2504f2d11e15aa19"></iframe><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="validating">Validating‚Ä¶<a class="hash-link" href="#validating" title="Direct link to heading">‚Äã</a></h2><p>Next we need to validate that the input is a valid JSON object, we can use the <code>json.Valid(body)</code> method to do this:</p><iframe width="100%" frameborder="0" id="gist-c7afe41fcca4ba1e3ed009044cea76de"></iframe><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="unmarshalling">Unmarshalling‚Ä¶<a class="hash-link" href="#unmarshalling" title="Direct link to heading">‚Äã</a></h2><p>Now the interesting bits, we will deserialize the JSON object to the empty data interface we created earlier using the <code>json.Unmarshal()</code> method:</p><iframe width="100%" frameborder="0" id="gist-2579ec79be915fb89e91ea0977bfbff6"></iframe><p>Note that this operation is another opportunity to catch unexpected errors and handle them accordingly.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="checking-the-type-of-the-object-using-reflection">Checking the type of the object using reflection‚Ä¶<a class="hash-link" href="#checking-the-type-of-the-object-using-reflection" title="Direct link to heading">‚Äã</a></h2><p>Now that we have serialized the JSON object into the data interface, there are several ways we can inspect the type of the object (which could be a map or an array). One such way is to use reflection. Reflection is the ability of a program to inspect itself at runtime. An example is shown here:</p><iframe width="100%" frameborder="0" id="gist-1ccd077de0fdee8973e25ac79719cbf5"></iframe><p>This instruction would produce the following output for our <code>zones.json</code> file:</p><iframe width="100%" frameborder="0" id="gist-04c1b3ae79e969e4be32ef7fa1c07736"></iframe><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="the-type-switch">The type switch‚Ä¶<a class="hash-link" href="#the-type-switch" title="Direct link to heading">‚Äã</a></h2><p>Another method to decode the type of the data object (and any objects nested as elements or keys within the data object), is to use the type switch, an example of a type switch function is shown here:</p><iframe width="100%" frameborder="0" id="gist-2e7a3d62ec6f7c71a9c01bfa8d360e4e"></iframe><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="finding-the-nested-collection-and-recursing-it">Finding the nested collection and recursing it‚Ä¶<a class="hash-link" href="#finding-the-nested-collection-and-recursing-it" title="Direct link to heading">‚Äã</a></h2><p>The aim of the program is to find a collection (an array of maps) nested in a JSON object. The maps with each element of the array are unknown at runtime and are discovered through recursion.</p><p>If we are performing a describe operation, we only need to parse the first element of the collection to get the key names and the data type of the values (for which we will use the same <code>getObjectType</code> function to perform a type switch.</p><p>If we are performing a select operation, we need to parse the first element to get the column names (the keys in the map) and then we need to recurse each element to get the values for each key.</p><p>If the element contains a key named id or name, we will place this at the beginning of the resultant record, as maps are unordered by definition.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="the-output">The output‚Ä¶<a class="hash-link" href="#the-output" title="Direct link to heading">‚Äã</a></h2><p>As mentioned, we are using the <code>tablewriter</code> package to render the output of the collection as a pretty printed table in our terminal. As wrap around can get pretty ugly an additional <code>maxfieldlen</code> argument is provided to truncate the values if needed.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="in-summary">In summary‚Ä¶<a class="hash-link" href="#in-summary" title="Direct link to heading">‚Äã</a></h2><p>Although it is a bit more involved than some other languages, once you get your head around processing JSON in Go, the possibilities are endless!</p><blockquote><p>Full source code can be found at: <a href="https://github.com/gamma-data/json-wrangling-with-golang" target="_blank" rel="noopener noreferrer">https://github.com/gamma-data/json-wrangling-with-golang</a></p></blockquote></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/golang">golang</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/json">json</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io/tree/main/src/blog/blog/2020-04-22-json-wrangling-with-go/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/automated-gcs-object-scanning-using-dlp-with-notifications-using-slack"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Automated GCS Object Scanning Using DLP with Notifications Using Slack</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/forseti-terraform-validator-enforcing-resource-policy-compliance-in-your-ci-pipeline"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Forseti Terraform Validator: Enforcing resource policy compliance in your CI pipeline</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a href="https://stackql.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>StackQL<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gammadata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gamma Data<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.windrate.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>WindRate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/cloudywithachanceofbigdata/cloudywithachanceofbigdata.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.711097e0.js"></script>
<script src="/assets/js/main.fe6a2a08.js"></script>
</body>
</html>